<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan Interactivo de Razonamiento Matemático - 4º ESO Ciencias</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #4A4A4A;
        }
        .filter-btn {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .filter-btn.active {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .week-card {
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
            transform: scale(1);
        }
        .week-card.filtered-out {
            opacity: 0.15;
            transform: scale(0.98);
        }
        .session-card.highlight {
            transform: scale(1.05);
            box-shadow: 0 0 0 2px #4F46E5;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">

        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Plan de Razonamiento Matemático 4º ESO Ciencias</h1>
            <p class="mt-2 text-lg text-gray-600">Cronograma interactivo para el curso completo (36 semanas)</p>
        </header>

        <main>
            <section id="controls" class="mb-12 p-6 bg-white rounded-2xl shadow-sm">
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Filtrar por Asignatura</h3>
                    <div id="subject-filters" class="flex flex-wrap gap-2"></div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Filtrar por Ámbito</h3>
                    <div id="ambito-filters" class="flex flex-wrap gap-2"></div>
                </div>
                 <div class="mt-6 flex flex-wrap justify-center gap-4">
                    <button id="reset-filters" class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75 transition">Mostrar Todo</button>
                </div>
            </section>
            
            <section id="summary" class="mb-12">
                 <div class="bg-white rounded-2xl shadow-sm p-6">
                    <h2 class="text-xl font-bold text-gray-800 text-center mb-4">Distribución Proporcional de Sesiones</h2>
                    <p class="text-center text-gray-600 mb-6 max-w-2xl mx-auto">
                        Este gráfico ilustra la distribución de las 72 sesiones (Sesión 2 y 3) a lo largo del curso. La asignación es proporcional a la carga horaria semanal de cada materia, garantizando un reparto equitativo.
                    </p>
                    <div class="chart-container relative w-full max-w-lg mx-auto h-80 md:h-96">
                        <canvas id="proportionalityChart"></canvas>
                    </div>
                </div>
            </section>

            <section id="schedule">
                <h2 class="text-2xl font-bold text-gray-800 text-center mb-8">Cronograma del Curso Escolar Completo</h2>
                <div id="evaluations-container" class="space-y-6">
                    <!-- Primera Evaluación -->
                    <div class="evaluation-section bg-white rounded-2xl shadow-sm overflow-hidden">
                        <button class="w-full text-left p-6 flex justify-between items-center cursor-pointer focus:outline-none" onclick="toggleEvaluation(1)">
                            <h3 class="text-xl font-bold text-gray-800">Primera Evaluación (14 Semanas)</h3>
                            <span id="toggle-icon-1" class="text-2xl font-bold transform transition-transform duration-300">+</span>
                        </button>
                        <div id="evaluation-content-1" class="p-5 border-t border-gray-200 space-y-6 hidden">
                            <!-- Las semanas se renderizarán aquí -->
                        </div>
                    </div>
                    <!-- Segunda Evaluación -->
                    <div class="evaluation-section bg-white rounded-2xl shadow-sm overflow-hidden">
                        <button class="w-full text-left p-6 flex justify-between items-center cursor-pointer focus:outline-none" onclick="toggleEvaluation(2)">
                            <h3 class="text-xl font-bold text-gray-800">Segunda Evaluación (11 Semanas)</h3>
                            <span id="toggle-icon-2" class="text-2xl font-bold transform transition-transform duration-300">+</span>
                        </button>
                        <div id="evaluation-content-2" class="p-5 border-t border-gray-200 space-y-6 hidden">
                            <!-- Las semanas se renderizarán aquí -->
                        </div>
                    </div>
                    <!-- Tercera Evaluación -->
                    <div class="evaluation-section bg-white rounded-2xl shadow-sm overflow-hidden">
                        <button class="w-full text-left p-6 flex justify-between items-center cursor-pointer focus:outline-none" onclick="toggleEvaluation(3)">
                            <h3 class="text-xl font-bold text-gray-800">Tercera Evaluación (11 Semanas)</h3>
                            <span id="toggle-icon-3" class="text-2xl font-bold transform transition-transform duration-300">+</span>
                        </button>
                        <div id="evaluation-content-3" class="p-5 border-t border-gray-200 space-y-6 hidden">
                            <!-- Las semanas se renderizarán aquí -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

<script>
    // --- CONFIGURACIÓN PRINCIPAL ---
    const materiasHoras = {
        'Lengua': 4, 'Geografía e Historia': 3, 'Inglés': 4, 'Religión': 1,
        'Biología y Geología': 3, 'Física y Química': 3, 'Tecnología': 3, 'Cultura Científica': 2,
        'Dibujo Técnico': 2, 'Ed. Física': 2
    };
    const totalSemanas = 36; // 14+11+11
    const totalSesiones = totalSemanas * 2; // Sesiones 2 y 3

    // --- CÁLCULO DE PROPORCIONALIDAD ---
    const totalHorasSinMatematicas = Object.values(materiasHoras).reduce((sum, hours) => sum + hours, 0);
    const sesionPorHora = totalSesiones / totalHorasSinMatematicas;
    const sesionesPorMateria = Object.keys(materiasHoras).reduce((acc, materia) => {
        acc[materia] = Math.round(materiasHoras[materia] * sesionPorHora);
        return acc;
    }, {});
    
    // Ajuste para asegurar que la suma sea exactamente 72
    const sumaTotal = Object.values(sesionesPorMateria).reduce((a, b) => a + b, 0);
    if (sumaTotal !== totalSesiones) {
        const diferencia = totalSesiones - sumaTotal;
        // Ajustar la materia con más horas
        const materiaAjustar = Object.keys(sesionesPorMateria).reduce((a, b) => 
            sesionesPorMateria[a] > sesionesPorMateria[b] ? a : b
        );
        sesionesPorMateria[materiaAjustar] += diferencia;
    }

    const ambitosMaterias = {
        'SL': ['Lengua', 'Geografía e Historia', 'Inglés', 'Religión'],
        'CT': ['Biología y Geología', 'Física y Química', 'Tecnología', 'Cultura Científica', 'Matemáticas'],
        'AR': ['Dibujo Técnico', 'Ed. Física']
    };

    function getAmbito(materia) {
        for (const ambito in ambitosMaterias) {
            if (ambitosMaterias[ambito].includes(materia)) return ambito;
        }
        return 'Desconocido';
    }

    // --- DISTRIBUCIÓN UNIFORME ENTRE EVALUACIONES ---
    function distribuirSesionesEntreEvaluaciones(sesionesPorMateria) {
        const evaluaciones = {
            primera: 14,  // semanas
            segunda: 11,  // semanas  
            tercera: 11   // semanas
        };
        
        const resultado = {
            primera: { CT: [], SLAR: [] },
            segunda: { CT: [], SLAR: [] },
            tercera: { CT: [], SLAR: [] }
        };

        // Para cada materia, distribuir sus sesiones entre evaluaciones
        Object.keys(sesionesPorMateria).forEach(materia => {
            const ambito = getAmbito(materia);
            const totalSesionesMateria = sesionesPorMateria[materia];
            
            if (ambito === 'CT' && materia !== 'Matemáticas') {
                // Distribuir sesiones CT entre evaluaciones
                const sesionesPorEvaluacion = distribuirProporcionalmente(totalSesionesMateria, evaluaciones);
                
                // Añadir a cada evaluación
                for (let i = 0; i < sesionesPorEvaluacion.primera; i++) {
                    resultado.primera.CT.push(materia);
                }
                for (let i = 0; i < sesionesPorEvaluacion.segunda; i++) {
                    resultado.segunda.CT.push(materia);
                }
                for (let i = 0; i < sesionesPorEvaluacion.tercera; i++) {
                    resultado.tercera.CT.push(materia);
                }
            } else if (ambito === 'SL' || ambito === 'AR') {
                // Distribuir sesiones SL/AR entre evaluaciones
                const sesionesPorEvaluacion = distribuirProporcionalmente(totalSesionesMateria, evaluaciones);
                
                // Añadir a cada evaluación
                for (let i = 0; i < sesionesPorEvaluacion.primera; i++) {
                    resultado.primera.SLAR.push(materia);
                }
                for (let i = 0; i < sesionesPorEvaluacion.segunda; i++) {
                    resultado.segunda.SLAR.push(materia);
                }
                for (let i = 0; i < sesionesPorEvaluacion.tercera; i++) {
                    resultado.tercera.SLAR.push(materia);
                }
            }
        });

        // Mezclar aleatoriamente dentro de cada evaluación para evitar patrones
        resultado.primera.CT = mezclarArray(resultado.primera.CT);
        resultado.segunda.CT = mezclarArray(resultado.segunda.CT);
        resultado.tercera.CT = mezclarArray(resultado.tercera.CT);
        
        resultado.primera.SLAR = mezclarArray(resultado.primera.SLAR);
        resultado.segunda.SLAR = mezclarArray(resultado.segunda.SLAR);
        resultado.tercera.SLAR = mezclarArray(resultado.tercera.SLAR);

        return resultado;
    }

    function distribuirProporcionalmente(totalSesiones, evaluaciones) {
        const totalSemanas = evaluaciones.primera + evaluaciones.segunda + evaluaciones.tercera;
        
        const primera = Math.round((totalSesiones * evaluaciones.primera) / totalSemanas);
        const segunda = Math.round((totalSesiones * evaluaciones.segunda) / totalSemanas);
        const tercera = totalSesiones - primera - segunda;
        
        return { primera, segunda, tercera };
    }

    function mezclarArray(array) {
        const nuevoArray = [...array];
        for (let i = nuevoArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [nuevoArray[i], nuevoArray[j]] = [nuevoArray[j], nuevoArray[i]];
        }
        return nuevoArray;
    }

    // Generar distribución entre evaluaciones
    const distribucionEvaluaciones = distribuirSesionesEntreEvaluaciones(sesionesPorMateria);

    // --- CATÁLOGO DE ACTIVIDADES (SABERES BÁSICOS) ---
    const actividadesCE = {
        'Matemáticas': [
            { desc: 'Resolución de problemas con potencias y raíces. Notación científica.', ce: 'MA.C.E.2.1' },
            { desc: 'Aplicación de porcentajes y proporcionalidad en contextos financieros.', ce: 'MA.C.E.2.2' },
            { desc: 'Simplificación y operaciones con polinomios. Identidades notables.', ce: 'MA.C.E.2.3' },
            { desc: 'Resolución de ecuaciones de 1º y 2º grado. Sistemas de ecuaciones.', ce: 'MA.C.E.2.4' },
            { desc: 'Análisis de sucesiones numéricas. Progresiones aritméticas y geométricas.', ce: 'MA.C.E.2.5' },
            { desc: 'Modelización de problemas reales mediante funciones lineales y afines.', ce: 'MA.C.E.3.1' },
            { desc: 'Estudio de funciones cuadráticas: vértice, eje y puntos de corte.', ce: 'MA.C.E.3.2' },
            { desc: 'Interpretación de funciones definidas a trozos en fenómenos cotidianos.', ce: 'MA.C.E.3.3' },
            { desc: 'Problemas de optimización usando funciones exponenciales y logarítmicas.', ce: 'MA.C.E.3.4' },
            { desc: 'Teorema de Pitágoras y de Tales en la resolución de problemas geométricos.', ce: 'MA.C.E.4.1' },
            { desc: 'Cálculo de áreas y volúmenes de cuerpos geométricos. Semejanza.', ce: 'MA.C.E.4.2' },
            { desc: 'Uso de la trigonometría para resolver problemas de alturas y distancias.', ce: 'MA.C.E.4.3' },
            { desc: 'Cálculo de probabilidades simples y compuestas. Diagramas de árbol.', ce: 'MA.C.E.5.1' },
            { desc: 'Elaboración e interpretación de tablas de frecuencias y gráficos estadísticos.', ce: 'MA.C.E.5.2' },
            { desc: 'Cálculo de medidas de centralización (media, moda, mediana) y dispersión.', ce: 'MA.C.E.5.3' },
            { desc: 'Análisis de la representatividad en muestras estadísticas. Sesgos.', ce: 'MA.C.E.5.4' },
            { desc: 'Resolución de inecuaciones de primer grado y su representación.', ce: 'MA.C.E.2.4' },
            { desc: 'Factorización de polinomios. Regla de Ruffini.', ce: 'MA.C.E.2.3' },
            { desc: 'Operaciones con radicales. Racionalización.', ce: 'MA.C.E.2.1' },
            { desc: 'Problemas de mezclas y aleaciones usando sistemas de ecuaciones.', ce: 'MA.C.E.2.4' },
            { desc: 'Análisis del dominio y recorrido de funciones elementales.', ce: 'MA.C.E.3.1' },
            { desc: 'Problemas geométricos con vectores. Módulo y dirección.', ce: 'MA.C.E.4.4' },
            { desc: 'Estudio de transformaciones geométricas: traslaciones, giros y simetrías.', ce: 'MA.C.E.4.5' },
            { desc: 'Experimentos aleatorios. Ley de Laplace.', ce: 'MA.C.E.5.1' },
            { desc: 'Interpretación de la correlación y regresión lineal en diagramas de dispersión.', ce: 'MA.C.E.5.5' },
            { desc: 'Resolución de problemas con ecuaciones exponenciales y logarítmicas.', ce: 'MA.C.E.2.4' },
            { desc: 'Uso de la hoja de cálculo para análisis de datos y funciones.', ce: 'MA.C.E.1.2' },
            { desc: 'Creación de conjeturas y demostraciones sencillas sobre propiedades numéricas.', ce: 'MA.C.E.1.1' },
            { desc: 'Optimización de recorridos usando teoría de grafos.', ce: 'MA.C.E.1.3' },
            { desc: 'Análisis de patrones en fractales y series geométricas.', ce: 'MA.C.E.2.5' },
            { desc: 'Comparación de ofertas bancarias: interés simple y compuesto.', ce: 'MA.C.E.2.2' },
            { desc: 'Diseño de un estudio estadístico: población, muestra y variables.', ce: 'MA.C.E.5.4' },
            { desc: 'Problemas de combinatoria: variaciones, permutaciones y combinaciones.', ce: 'MA.C.E.5.1' },
            { desc: 'Modelado de crecimiento de poblaciones con funciones exponenciales.', ce: 'MA.C.E.3.4' },
            { desc: 'Resolución de triángulos no rectángulos. Teoremas del seno y coseno.', ce: 'MA.C.E.4.3' },
            { desc: 'Análisis crítico de gráficos estadísticos en los medios de comunicación.', ce: 'MA.C.E.5.2' }
        ],
        'Biología y Geología': [
            { desc: 'Calcular la probabilidad de herencia de caracteres genéticos (Leyes de Mendel).', ce: 'BG.C.E.4.3' },
            { desc: 'Interpretar pirámides de biomasa y energía en un ecosistema.', ce: 'BG.C.E.3.2' },
            { desc: 'Modelizar la replicación del ADN y la síntesis de proteínas.', ce: 'BG.C.E.4.1' },
            { desc: 'Analizar gráficos de dinámica de poblaciones (crecimiento, competencia).', ce: 'BG.C.E.3.3' },
            { desc: 'Calcular escalas y perfiles topográficos a partir de un mapa geológico.', ce: 'BG.C.E.2.2' },
            { desc: 'Estimar la huella ecológica personal y proponer un plan de reducción.', ce: 'BG.C.E.3.5' },
            { desc: 'Clasificar organismos usando claves dicotómicas basadas en sus caracteres.', ce: 'BG.C.E.3.1' }
        ],
        'Física y Química': [
            { desc: 'Resolver problemas de cinemática (MRU, MRUA) con gráficas e-t, v-t.', ce: 'FQ.C.E.2.1' },
            { desc: 'Aplicar la 2ª Ley de Newton para calcular fuerzas, masas o aceleraciones.', ce: 'FQ.C.E.2.2' },
            { desc: 'Realizar cálculos estequiométricos en reacciones químicas sencillas.', ce: 'FQ.C.E.3.3' },
            { desc: 'Calcular la concentración de disoluciones en diferentes unidades.', ce: 'FQ.C.E.3.2' },
            { desc: 'Aplicar la Ley de Ohm en circuitos eléctricos simples (serie y paralelo).', ce: 'FQ.C.E.2.4' },
            { desc: 'Balancear ecuaciones químicas por el método de tanteo.', ce: 'FQ.C.E.3.3' },
            { desc: 'Interpretar la tabla periódica para predecir propiedades de los elementos.', ce: 'FQ.C.E.3.1' }
        ],
        'Tecnología': [
            { desc: 'Diseñar un algoritmo (diagrama de flujo) para un sistema automatizado.', ce: 'T.C.E.3.1' },
            { desc: 'Calcular relaciones de transmisión y velocidades en sistemas de engranajes.', ce: 'T.C.E.2.2' },
            { desc: 'Programar un microcontrolador (Arduino) para resolver un reto simple.', ce: 'T.C.E.3.2' },
            { desc: 'Diseñar un objeto 3D con medidas precisas usando software CAD.', ce: 'T.C.E.4.1' },
            { desc: 'Calcular el presupuesto para un proyecto tecnológico, optimizando costes.', ce: 'T.C.E.1.3' },
            { desc: 'Implementar estructuras de control (if, for, while) en un lenguaje de programación.', ce: 'T.C.E.3.1' }
        ],
        'Cultura Científica': [
            { desc: 'Analizar la validez de un estudio científico a partir de su muestra y método.', ce: 'CC.C.E.1.2' },
            { desc: 'Interpretar gráficos sobre el cambio climático y calcular tendencias.', ce: 'CC.C.E.3.1' },
            { desc: 'Crear un modelo a escala del sistema solar respetando proporciones.', ce: 'CC.C.E.2.1' },
            { desc: 'Debatir sobre dilemas éticos en avances científicos (IA, genética) usando argumentos lógicos.', ce: 'CC.C.E.1.4' }
        ],
        'Lengua': [
            { desc: 'Analizar la estructura lógica (tesis, argumentos, contraargumentos) de un editorial.', ce: 'LCL.C.E.2.1' },
            { desc: 'Crear un texto argumentativo aplicando diferentes tipos de falacias para su posterior identificación.', ce: 'LCL.C.E.2.3' },
            { desc: 'Transformar un poema en un diagrama de flujo que represente su estructura y progresión temática.', ce: 'LCL.C.E.3.1' },
            { desc: 'Analizar la frecuencia de uso de diferentes categorías gramaticales en textos de varios ámbitos.', ce: 'LCL.C.E.4.1' },
            { desc: 'Detectar ambigüedades sintácticas y proponer reformulaciones precisas.', ce: 'LCL.C.E.4.2' },
            { desc: 'Formalizar la estructura de un mito clásico como una secuencia de acciones lógicas.', ce: 'LCL.C.E.3.2' },
            { desc: 'Diseñar un argumentario para un debate, previendo las refutaciones del contrario.', ce: 'LCL.C.E.1.2' },
            { desc: 'Elaborar un mapa conceptual que organice jerárquicamente las ideas de un texto expositivo.', ce: 'LCL.C.E.2.2' }
        ],
        'Geografía e Historia': [
            { desc: 'Interpretar pirámides de población y calcular tasas de natalidad/mortalidad.', ce: 'GEH.C.E.2.2' },
            { desc: 'Analizar climogramas para identificar tipos de clima y deducir la vegetación asociada.', ce: 'GEH.C.E.2.1' },
            { desc: 'Calcular la densidad de población y analizar su distribución en un mapa temático.', ce: 'GEH.C.E.2.2' },
            { desc: 'Interpretar gráficos de sectores sobre la estructura económica de un país (primario, secundario, terciario).', ce: 'GEH.C.E.3.1' },
            { desc: 'Crear un mapa de flujos para representar migraciones o rutas comerciales.', ce: 'GEH.C.E.1.1' },
            { desc: 'Analizar la correlación entre el IDH y otros indicadores socioeconómicos a partir de datos.', ce: 'GEH.C.E.3.2' }
        ],
        'Inglés': [
            { desc: 'Resolver un "logic puzzle" redactado en inglés, justificando las deducciones.', ce: 'IN.C.E.2.1' },
            { desc: 'Escribir un conjunto de instrucciones precisas (algoritmo) para una tarea compleja.', ce: 'IN.C.E.3.2' },
            { desc: 'Describir un gráfico (bar chart, line graph) analizando tendencias y comparando datos.', ce: 'IN.C.E.1.2' },
            { desc: 'Participar en un debate estructurado sobre un tema controvertido, usando conectores lógicos.', ce: 'IN.C.E.4.1' },
            { desc: 'Crear un "escape room" basado en acertijos lingüísticos y lógicos.', ce: 'IN.C.E.3.1' },
            { desc: 'Analizar un artículo de noticias e identificar hechos, opiniones y posibles sesgos.', ce: 'IN.C.E.2.2' }
        ],
        'Religión': [
            { desc: 'Aplicar un modelo de toma de decisiones éticas a un dilema moral complejo.', ce: 'RE.C.E.3.1' },
            { desc: 'Analizar la estructura lógica de una parábola o texto sagrado.', ce: 'RE.C.E.1.2' },
            { desc: 'Comparar principios éticos de diferentes religiones usando un diagrama de Venn.', ce: 'RE.C.E.2.1' }
        ],
        'Dibujo Técnico': [
            { desc: 'Resolver problemas de tangencias entre rectas y circunferencias usando construcciones geométricas.', ce: 'DT.C.E.2.1' },
            { desc: 'Dibujar las vistas (alzado, planta, perfil) de un objeto tridimensional dado en perspectiva.', ce: 'DT.C.E.1.1' },
            { desc: 'Aplicar escalas gráficas para la representación y acotación de un plano.', ce: 'DT.C.E.1.2' },
            { desc: 'Construir polígonos regulares y estrellados aplicando principios de la división de la circunferencia.', ce: 'DT.C.E.2.2' }
        ],
        'Ed. Física': [
            { desc: 'Analizar un vídeo de un gesto deportivo (salto, lanzamiento) y descomponerlo en fases y ángulos.', ce: 'EF.C.E.3.1' },
            { desc: 'Diseñar una estrategia de juego para un deporte de equipo (fútbol, baloncesto) usando un diagrama táctico.', ce: 'EF.C.E.4.2' },
            { desc: 'Registrar y analizar datos de frecuencia cardíaca durante el ejercicio para optimizar el entrenamiento.', ce: 'EF.C.E.1.1' }
        ]
    };

    // --- ENLACES PARA EVIDENCIAS (CARGADOS DESDE CSV) ---
    const sessionLinks = [
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B5", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E5", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H5" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B10", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E10", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H10" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B17", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E17", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H17" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B22", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E22", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H22" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B27", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E27", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H27" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B32", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E33", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H32" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B37", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E37", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H37" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B44", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E44", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H44" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B49", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E49", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H49" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B54", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E54", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H54" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B59", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E59", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H59" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B66", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E66", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H66" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B71", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E71", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H71" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B76", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E76", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H76" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B83", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E83", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H83" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B88", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E88", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H88" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B93", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E93", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H93" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B100", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E100", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H100" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B105", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E105", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H105" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B110", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E110", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H110" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B115", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E115", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H115" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B122", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E122", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H122" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B127", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E127", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H127" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B132", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E132", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H132" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B137", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E137", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H137" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B144", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E144", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H144" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B149", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E149", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H149" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B154", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E154", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H154" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B159", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E159", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H159" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B166", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E166", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H166" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B171", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E171", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H171" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B176", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E176", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H176" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B181", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E181", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H181" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B188", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E188", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H188" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B193", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E193", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H193" },
        { s1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B198", s2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E198", s3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H198" }
    ];

    // --- GENERACIÓN DEL CRONOGRAMA ---
    const scheduleData = [];
    const activityCounters = Object.keys(actividadesCE).reduce((acc, key) => { acc[key] = 0; return acc; }, {});

    function getNextActivity(subject) {
        if (!actividadesCE[subject] || actividadesCE[subject].length === 0) {
            return { desc: 'Actividad pendiente de definir.', ce: 'C.E. pendiente' };
        }
        const activities = actividadesCE[subject];
        const activity = activities[activityCounters[subject] % activities.length];
        activityCounters[subject]++;
        return activity;
    }

    // Generar el cronograma con distribución entre evaluaciones
    let semanaGlobal = 0;
    
    // Primera evaluación (semanas 1-14)
    for (let i = 0; i < 14; i++) {
        const semanaData = { week: ++semanaGlobal };
        
        // Sesión 1: Matemáticas
        const s1_activity = getNextActivity('Matemáticas');
        semanaData.session1 = { subject: 'Matemáticas', ambito: 'CT', activity: s1_activity.desc, ce: s1_activity.ce };
        
        // Sesión 2: CT de la primera evaluación
        const s2_subject = distribucionEvaluaciones.primera.CT[i] || 'Sin asignar';
        const s2_activity = getNextActivity(s2_subject);
        semanaData.session2 = { subject: s2_subject, ambito: 'CT', activity: s2_activity.desc, ce: s2_activity.ce };
        
        // Sesión 3: SL/AR de la primera evaluación
        const s3_subject = distribucionEvaluaciones.primera.SLAR[i] || 'Sin asignar';
        const s3_activity = getNextActivity(s3_subject);
        semanaData.session3 = { subject: s3_subject, ambito: getAmbito(s3_subject), activity: s3_activity.desc, ce: s3_activity.ce };
        
        scheduleData.push(semanaData);
    }
    
    // Segunda evaluación (semanas 15-25)
    for (let i = 0; i < 11; i++) {
        const semanaData = { week: ++semanaGlobal };
        
        // Sesión 1: Matemáticas
        const s1_activity = getNextActivity('Matemáticas');
        semanaData.session1 = { subject: 'Matemáticas', ambito: 'CT', activity: s1_activity.desc, ce: s1_activity.ce };
        
        // Sesión 2: CT de la segunda evaluación
        const s2_subject = distribucionEvaluaciones.segunda.CT[i] || 'Sin asignar';
        const s2_activity = getNextActivity(s2_subject);
        semanaData.session2 = { subject: s2_subject, ambito: 'CT', activity: s2_activity.desc, ce: s2_activity.ce };
        
        // Sesión 3: SL/AR de la segunda evaluación
        const s3_subject = distribucionEvaluaciones.segunda.SLAR[i] || 'Sin asignar';
        const s3_activity = getNextActivity(s3_subject);
        semanaData.session3 = { subject: s3_subject, ambito: getAmbito(s3_subject), activity: s3_activity.desc, ce: s3_activity.ce };
        
        scheduleData.push(semanaData);
    }
    
    // Tercera evaluación (semanas 26-36)
    for (let i = 0; i < 11; i++) {
        const semanaData = { week: ++semanaGlobal };
        
        // Sesión 1: Matemáticas
        const s1_activity = getNextActivity('Matemáticas');
        semanaData.session1 = { subject: 'Matemáticas', ambito: 'CT', activity: s1_activity.desc, ce: s1_activity.ce };
        
        // Sesión 2: CT de la tercera evaluación
        const s2_subject = distribucionEvaluaciones.tercera.CT[i] || 'Sin asignar';
        const s2_activity = getNextActivity(s2_subject);
        semanaData.session2 = { subject: s2_subject, ambito: 'CT', activity: s2_activity.desc, ce: s2_activity.ce };
        
        // Sesión 3: SL/AR de la tercera evaluación
        const s3_subject = distribucionEvaluaciones.tercera.SLAR[i] || 'Sin asignar';
        const s3_activity = getNextActivity(s3_subject);
        semanaData.session3 = { subject: s3_subject, ambito: getAmbito(s3_subject), activity: s3_activity.desc, ce: s3_activity.ce };
        
        scheduleData.push(semanaData);
    }

    const subjectColors = {
        'Matemáticas': '#4F46E5', 'Biología y Geología': '#10B981', 'Física y Química': '#0EA5E9', 'Tecnología': '#D946EF', 'Cultura Científica': '#F97316',
        'Lengua': '#EAB308', 'Geografía e Historia': '#8B5CF6', 'Inglés': '#EC4899', 'Religión': '#6B7280',
        'Dibujo Técnico': '#EF4444', 'Ed. Física': '#3B82F6', 'Sin asignar': '#9CA3AF'
    };
    
function generateDates() {
    const dates = [];
    
    // Primera Evaluación (14 semanas) - desde septiembre
    let currentDay = new Date('2025-09-15T00:00:00Z');
    for (let i = 0; i < 14; i++) {
        const start = new Date(currentDay);
        const end = new Date(currentDay);
        end.setDate(currentDay.getDate() + 4); // Lunes a Viernes
        dates.push({ start, end });
        currentDay.setDate(currentDay.getDate() + 7);
    }
    
    // Segunda Evaluación (11 semanas) - empieza el 12 de enero de 2026
    currentDay = new Date('2026-01-12T00:00:00Z');
    for (let i = 0; i < 11; i++) {
        const start = new Date(currentDay);
        const end = new Date(currentDay);
        end.setDate(currentDay.getDate() + 4); // Lunes a Viernes
        dates.push({ start, end });
        currentDay.setDate(currentDay.getDate() + 7);
    }
    
    // Tercera Evaluación (11 semanas) - empieza el 6 de abril de 2026
    currentDay = new Date('2026-04-06T00:00:00Z');
    for (let i = 0; i < 11; i++) {
        const start = new Date(currentDay);
        const end = new Date(currentDay);
        end.setDate(currentDay.getDate() + 4); // Lunes a Viernes
        dates.push({ start, end });
        currentDay.setDate(currentDay.getDate() + 7);
    }
    
    return dates;
}	

    const weekDates = generateDates();

    function toggleEvaluation(evaluationNumber) {
        const content = document.getElementById(`evaluation-content-${evaluationNumber}`);
        const icon = document.getElementById(`toggle-icon-${evaluationNumber}`);
        content.classList.toggle('hidden');
        icon.textContent = content.classList.contains('hidden') ? '+' : '-';
    }
    window.toggleEvaluation = toggleEvaluation;

    function renderSchedule(data, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        data.forEach(weekData => {
            const weekCard = document.createElement('div');
            weekCard.className = 'week-card bg-gray-50 rounded-2xl shadow-sm p-5';
            weekCard.dataset.week = weekData.week;

            const weekIndex = weekData.week - 1;
            const dateRange = weekDates[weekIndex]
                ? `del ${weekDates[weekIndex].start.toLocaleDateString('es-ES', { day: 'numeric', month: 'long' })} al ${weekDates[weekIndex].end.toLocaleDateString('es-ES', { day: 'numeric', month: 'long' })}`
                : 'Fechas no disponibles';

            weekCard.innerHTML = `
                <h3 class="text-xl font-bold text-indigo-700 mb-2">Semana ${weekData.week}</h3>
                <p class="text-sm text-gray-500 mb-4">${dateRange}</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    ${createSessionCard(weekData.session1, 1, weekData.week)}
                    ${createSessionCard(weekData.session2, 2, weekData.week)}
                    ${createSessionCard(weekData.session3, 3, weekData.week)}
                </div>
            `;
            container.appendChild(weekCard);
        });
    }

    function createSessionCard(session, sessionNumber, weekNumber) {
        const weekLinks = sessionLinks[weekNumber - 1] || {};
        const link = weekLinks[`s${sessionNumber}`] || '#';

        return `
            <div class="session-card bg-white rounded-xl p-4 border border-gray-200 transition-all duration-300 flex flex-col" 
                 data-subject="${session.subject}" data-ambito="${session.ambito}"
                 style="border-left: 5px solid ${subjectColors[session.subject] || '#6B7280'};">
                <div class="flex-grow">
                    <p class="font-semibold text-sm text-gray-500">Sesión ${sessionNumber}</p>
                    <p class="font-bold text-gray-800">${session.subject}</p>
                    <p class="text-sm text-gray-600 mt-2">${session.activity}</p>
                    <p class="text-xs text-gray-400 mt-3 font-mono">CE: ${session.ce}</p>
                </div>
                <div class="mt-4 flex-shrink-0">
                    <a href="${link}" target="_blank" rel="noopener noreferrer" class="inline-block bg-indigo-100 text-indigo-800 text-xs font-semibold py-1.5 px-3 rounded-full hover:bg-indigo-200 transition-colors duration-200">
                        Registrar evidencia
                    </a>
                </div>
            </div>
        `;
    }
    
    function applyFilter(filterValue, filterType) {
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active', 'bg-indigo-600', 'text-white'));
        const activeButton = document.querySelector(`.filter-btn[data-filter="${filterValue}"][data-type="${filterType}"]`);
        if (activeButton) {
            activeButton.classList.add('active', 'bg-indigo-600', 'text-white');
        }

        document.querySelectorAll('.week-card').forEach(weekCard => {
            let weekHasMatch = false;
            weekCard.querySelectorAll('.session-card').forEach(sessionCard => {
                const isMatch = sessionCard.dataset[filterType] === filterValue;
                if (isMatch) {
                    sessionCard.classList.remove('opacity-40');
                    sessionCard.classList.add('highlight');
                    weekHasMatch = true;
                } else {
                    sessionCard.classList.add('opacity-40');
                    sessionCard.classList.remove('highlight');
                }
            });
            
            weekCard.classList.toggle('filtered-out', !weekHasMatch);
        });
    }

    function resetFilters() {
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active', 'bg-indigo-600', 'text-white'));
        document.querySelectorAll('.week-card').forEach(card => card.classList.remove('filtered-out'));
        document.querySelectorAll('.session-card').forEach(card => card.classList.remove('opacity-40', 'highlight'));
    }

    function renderChart() {
        const ctx = document.getElementById('proportionalityChart').getContext('2d');
        const sessionCounts = {};
        scheduleData.forEach(week => {
            [week.session2, week.session3].forEach(s => {
                if (s.subject !== 'Sin asignar') {
                    sessionCounts[s.subject] = (sessionCounts[s.subject] || 0) + 1;
                }
            });
        });
        
        const sortedSubjects = Object.keys(sessionCounts).sort((a, b) => sessionCounts[b] - sessionCounts[a]);
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: sortedSubjects,
                datasets: [{
                    label: 'Nº de Sesiones',
                    data: sortedSubjects.map(s => sessionCounts[s]),
                    backgroundColor: sortedSubjects.map(s => subjectColors[s] || '#6B7280'),
                    borderColor: '#FDFBF8', borderWidth: 3, hoverOffset: 10
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom', labels: { font: { family: 'Inter', size: 12 }, boxWidth: 15, padding: 15 }},
                    tooltip: { callbacks: { label: c => `${c.label}: ${c.parsed} sesiones` } }
                }
            }
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        const subjectFiltersContainer = document.getElementById('subject-filters');
        const ambitoFiltersContainer = document.getElementById('ambito-filters');
        const subjects = Object.keys(materiasHoras).concat('Matemáticas').sort();
        const ambitos = [...new Set(Object.values(ambitosMaterias).flat())].map(getAmbito).filter((v, i, a) => a.indexOf(v) === i && v !== 'Desconocido').sort();

        function createFilterButtons(container, items, type) {
            items.forEach(item => {
                const button = document.createElement('button');
                button.textContent = item;
                button.dataset.filter = item;
                button.dataset.type = type;
                button.className = 'filter-btn px-4 py-1.5 text-sm font-medium text-gray-700 bg-gray-100 rounded-full hover:bg-gray-200';
                container.appendChild(button);
            });
        }
        createFilterButtons(subjectFiltersContainer, subjects, 'subject');
        createFilterButtons(ambitoFiltersContainer, ambitos, 'ambito');
        
        renderSchedule(scheduleData.slice(0, 14), 'evaluation-content-1');
        renderSchedule(scheduleData.slice(14, 25), 'evaluation-content-2');
        renderSchedule(scheduleData.slice(25, 36), 'evaluation-content-3');
        renderChart();
        
        document.getElementById('controls').addEventListener('click', e => {
            if (e.target.classList.contains('filter-btn')) {
                applyFilter(e.target.dataset.filter, e.target.dataset.type);
            }
        });
        document.getElementById('reset-filters').addEventListener('click', resetFilters);
    });
</script>
</body>
</html>