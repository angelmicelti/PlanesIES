<!DOCTYPE html>
<html lang="es">
<head>
	<link rel="manifest" href="./manifest.json" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <title>Plan Interactivo de Razonamiento Matemático - 4º ESO Sociales</title>
    <script src="https://unpkg.com/tailwindcss-cdn@3.4.10/tailwindcss.js"></script>
    	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #4A4A4A;
        }
        .filter-btn {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .filter-btn.active {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .week-card {
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
            transform: scale(1);
        }
        .week-card.filtered-out {
            display: none;
            opacity: 0;
            transform: scale(0.98);
        }
        .session-card {
            transition: transform 0.3s ease-in-out;
        }
        .session-card.highlight {
            transform: scale(1.05);
            box-shadow: 0 0 0 2px #4F46E5;
        }
        .hidden-content {
            display: none;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">

        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Plan Interdisciplinar de Razonamiento Matemático</h1>
            <p class="mt-2 text-lg text-gray-600">4º ESO - Itinerario de Humanidades y Ciencias Sociales</p>
        </header>

        <main>
            <section id="controls" class="mb-12 p-6 bg-white rounded-2xl shadow-sm">
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Filtrar por Asignatura</h3>
                    <div id="subject-filters" class="flex flex-wrap gap-2"></div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Filtrar por Ámbito</h3>
                    <div id="ambito-filters" class="flex flex-wrap gap-2"></div>
                </div>
                 <div class="mt-6 text-center">
                    <button id="reset-filters" class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75 transition">Mostrar Todo</button>
                </div>
            </section>
            
            <section id="summary" class="mb-12">
                 <div class="bg-white rounded-2xl shadow-sm p-6">
                    <h2 class="text-xl font-bold text-gray-800 text-center mb-4">Distribución Proporcional de Sesiones</h2>
                    <p class="text-center text-gray-600 mb-6 max-w-2xl mx-auto">
                        Este gráfico ilustra la distribución de las 72 sesiones interdisciplinares (Sesión 2 y 3) a lo largo del ciclo de 36 semanas. La asignación es directamente proporcional a la carga horaria semanal de cada materia, incluyendo las 2 horas adicionales de aportación de Matemáticas.
                    </p>
                    <div class="chart-container relative w-full max-w-lg mx-auto h-80 md:h-96">
                        <canvas id="proportionalityChart"></canvas>
                    </div>
                </div>
            </section>

            <section id="schedule">
                <h2 class="text-2xl font-bold text-gray-800 text-center mb-8">Cronograma del Curso Escolar Completo (36 Semanas)</h2>
                <div id="evaluations-container" class="space-y-6">
                    <!-- Primera Evaluación: 14 semanas (S. 1 a S. 14) -->
                    <div class="evaluation-section bg-white rounded-2xl shadow-sm overflow-hidden">
                        <button class="w-full text-left p-6 flex justify-between items-center cursor-pointer focus:outline-none" onclick="toggleEvaluation(1)">
                            <h3 class="text-xl font-bold text-gray-800">Primera Evaluación (Semanas 1-14)</h3>
                            <span id="toggle-icon-1" class="text-2xl font-bold transform transition-transform duration-300">+</span>
                        </button>
                        <div id="evaluation-content-1" class="p-5 border-t border-gray-200 space-y-6 hidden-content">
                            <!-- Las semanas se renderizarán aquí -->
                        </div>
                    </div>
                    <!-- Segunda Evaluación: 11 semanas (S. 15 a S. 25) -->
                    <div class="evaluation-section bg-white rounded-2xl shadow-sm overflow-hidden">
                        <button class="w-full text-left p-6 flex justify-between items-center cursor-pointer focus:outline-none" onclick="toggleEvaluation(2)">
                            <h3 class="text-xl font-bold text-gray-800">Segunda Evaluación (Semanas 15-25)</h3>
                            <span id="toggle-icon-2" class="text-2xl font-bold transform transition-transform duration-300">+</span>
                        </button>
                        <div id="evaluation-content-2" class="p-5 border-t border-gray-200 space-y-6 hidden-content">
                            <!-- Las semanas se renderizarán aquí -->
                        </div>
                    </div>
                    <!-- Tercera Evaluación: 11 semanas (S. 26 a S. 36) -->
                    <div class="evaluation-section bg-white rounded-2xl shadow-sm overflow-hidden">
                        <button class="w-full text-left p-6 flex justify-between items-center cursor-pointer focus:outline-none" onclick="toggleEvaluation(3)">
                            <h3 class="text-xl font-bold text-gray-800">Tercera Evaluación (Semanas 26-36)</h3>
                            <span id="toggle-icon-3" class="text-2xl font-bold transform transition-transform duration-300">+</span>
                        </button>
                        <div id="evaluation-content-3" class="p-5 border-t border-gray-200 space-y-6 hidden-content">
                            <!-- Las semanas se renderizarán aquí -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // --- DATA DE ENLACES DE EVIDENCIA (INCRUSTADA DESDE 4ºIT2.CSV) ---
        // Estructura: sessionLinks[Semana][Sesión] = URL_del_formulario
        const sessionLinks = {
            1: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B5",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E5",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H5"
            },
            2: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B10",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E10",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H10"
            },
            3: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B17",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E17",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H17"
            },
            4: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B22",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E22",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H22"
            },
            5: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B27",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E27",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H27"
            },
            6: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B32",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E32",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H32"
            },
            7: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B37",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E37",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H37"
            },
            8: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B44",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E44",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H44"
            },
            9: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B49",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E49",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H49"
            },
            10: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B54",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E54",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H54"
            },
            11: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B59",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E59",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H59"
            },
            12: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B66",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E66",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H66"
            },
            13: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B71",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E71",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H71"
            },
            14: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B76",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E76",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H76"
            },
            15: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B83",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E83",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H83"
            },
            16: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B88",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E88",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H88"
            },
            17: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B93",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E93",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H93"
            },
            18: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B100",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E100",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H100"
            },
            19: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B105",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E105",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H105"
            },
            20: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B110",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E110",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H110"
            },
            21: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B115",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E115",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H115"
            },
            22: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B122",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E122",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H122"
            },
            23: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B127",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E127",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H127"
            },
            24: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B132",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E132",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H132"
            },
            25: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B137",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E137",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H137"
            },
            26: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B144",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E144",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H144"
            },
            27: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B149",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E149",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H149"
            },
            28: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B154",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E154",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H154"
            },
            29: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B159",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E159",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H159"
            },
            30: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B166",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E166",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H166"
            },
            31: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B171",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E171",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H171"
            },
            32: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B176",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E176",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H176"
            },
            33: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B181",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E181",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H181"
            },
            34: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B188",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E188",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H188"
            },
            35: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B193",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E193",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H193"
            },
            36: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=B198",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=E198",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=940825436#gid=940825436&range=H198"
            }
        };

        // --- CONFIGURACIÓN AJUSTADA A 36 SEMANAS ---

        // Definición de las materias y sus horas de docencia directa (ACTUALIZADO con Educación Física)
        const subjects = {
            'Lengua': { hours: 4, ambito: 'SL' },
            'Geografía e Historia': { hours: 3, ambito: 'SL' },
            'Inglés': { hours: 4, ambito: 'SL' },
            'Religión': { hours: 1, ambito: 'SL' },
            'Ampliación de Cultura Clásica': { hours: 2, ambito: 'SL' },
            'Economía': { hours: 3, ambito: 'SL' },
            'Latín': { hours: 3, ambito: 'SL' },
            'Francés': { hours: 3, ambito: 'SL' },
            // Matemáticas tiene 4h fijas (Sesión 1) y 2h de peso para distribución interdisciplinar (Sesiones 2 y 3)
            'Matemáticas': { hours: 4, ambito: 'CT', interdisciplinary_weight: 2 },
            'Música': { hours: 3, ambito: 'AR' },
            'Educación Física': { hours: 2, ambito: 'AR' } // NUEVA MATERIA AÑADIDA
        };

        // 1. Cálculo del peso total para las Sesiones 2 y 3 (72 sesiones a repartir)
        // ACTUALIZADO: Ahora incluye Educación Física (2 horas)
        const totalHoursForDistribution = Object.keys(subjects).reduce((sum, key) => {
            const subject = subjects[key];
            // Sumamos las horas de las materias SL/AR
            if (subject.ambito !== 'CT') {
                return sum + subject.hours;
            }
            // Sumamos el peso interdisciplinar de Matemáticas (2 horas)
            if (key === 'Matemáticas' && subject.interdisciplinary_weight) {
                return sum + subject.interdisciplinary_weight;
            }
            return sum;
        }, 0);
        // El total de peso ahora es 30 (28 horas SL/AR + 2 horas Matemáticas)

        // Ajuste: 36 semanas * 2 sesiones/semana = 72 sesiones a distribuir
        const totalSessionsToDistribute = 72; 

        const subjectSessions = {};
        const subjectFractions = {};

        // 2. Distribución proporcional de las 72 sesiones
        Object.keys(subjects).forEach(key => {
            const subject = subjects[key];
            let weight = 0;

            if (subject.ambito !== 'CT') {
                // Materias SL/AR usan sus horas como peso
                weight = subject.hours;
            } else if (key === 'Matemáticas') {
                // Matemáticas usa su peso interdisciplinar (2 horas)
                weight = subject.interdisciplinary_weight || 0;
            }

            if (weight > 0) {
                const calculatedSessions = (weight / totalHoursForDistribution) * totalSessionsToDistribute;
                subjectSessions[key] = Math.floor(calculatedSessions);
                subjectFractions[key] = calculatedSessions - Math.floor(calculatedSessions);
            }
        });

        // Aseguramos que el total de sesiones sea exactamente 72 (método de redondeo por fracción)
        let currentTotalSessions = Object.values(subjectSessions).reduce((a, b) => a + b, 0);
        let remainingSessions = totalSessionsToDistribute - currentTotalSessions;

        const sortedByFraction = Object.entries(subjectFractions)
            .sort(([, a], [, b]) => b - a)
            .map(([key]) => key);

        for (let i = 0; i < remainingSessions; i++) {
            const subjectToAdjust = sortedByFraction[i % sortedByFraction.length];
            subjectSessions[subjectToAdjust]++;
        }
        
        // Generamos la secuencia de sesiones para las semanas 2 y 3 con distribución uniforme
        const sessionSequence = generateUniformSequence(subjectSessions, 72);
        
        // Función para generar una secuencia uniforme sin barajado aleatorio
        function generateUniformSequence(subjectSessions, totalSessions) {
            const sequence = [];
            const subjectCounts = { ...subjectSessions };
            const subjectsList = Object.keys(subjectCounts);
            
            let totalAssigned = 0;
            
            while (totalAssigned < totalSessions) {
                for (const subject of subjectsList) {
                    if (subjectCounts[subject] > 0) {
                        sequence.push(subject);
                        subjectCounts[subject]--;
                        totalAssigned++;
                        
                        if (totalAssigned >= totalSessions) break;
                    }
                }
            }
            
            return sequence;
        }

        // Definición de actividades y criterios de evaluación según la Orden de 30 de mayo de 2023 (ACTUALIZADO)
        const activitiesBySubject = {
            'Matemáticas': [
                { activity: 'Análisis de datos económicos y sociales usando herramientas estadísticas.', ce: 'MA.C.E.2.3' },
                { activity: 'Cálculo de la rentabilidad de una inversión usando funciones.', ce: 'MA.C.E.3.1' },
                { activity: 'Resolución de problemas de proporcionalidad inversa en la escala de mapas.', ce: 'MA.C.E.1.2' },
                { activity: 'Análisis de la influencia de variables en un modelo matemático.', ce: 'MA.C.E.4.4' },
                { activity: 'Diseño de un diagrama de flujo lógico para un proceso histórico o social.', ce: 'MA.C.E.4.1' },
                { activity: 'Evaluación de la validez de un argumento mediante lógica proposicional.', ce: 'MA.C.E.4.3' }
            ],
            'Lengua': [
                { activity: 'Identificación de falacias lógicas en un discurso político.', ce: 'LCL.C.E.1.4' },
                { activity: 'Organización de ideas para un debate siguiendo una estructura argumentativa.', ce: 'LCL.C.E.4.2' },
                { activity: 'Creación de un texto que justifique una opinión con razonamientos sólidos.', ce: 'LCL.C.E.5.3' },
                { activity: 'Análisis de la coherencia y cohesión de un párrafo.', ce: 'LCL.C.E.1.4' }
            ],
            'Geografía e Historia': [
                { activity: 'Interpretación de mapas temáticos (densidad de población, PIB).', ce: 'GEH.C.E.1.1' },
                { activity: 'Cálculo y análisis de la huella ecológica de una población.', ce: 'GEH.C.E.3.2' },
                { activity: 'Proyección del crecimiento demográfico a partir de datos históricos.', ce: 'GEH.C.E.2.4' },
                { activity: 'Análisis de patrones de migración a través de un diagrama de flujo.', ce: 'GEH.C.E.1.1' }
            ],
            'Inglés': [
                { activity: 'Resolución de problemas lógicos y acertijos en inglés.', ce: 'IN.C.E.3.3' },
                { activity: 'Análisis de la estructura lógica de un texto argumentativo en inglés.', ce: 'IN.C.E.4.2' },
                { activity: 'Elaboración de un árbol de decisión para una situación en inglés.', ce: 'IN.C.E.4.2' },
                { activity: 'Decodificación de mensajes secretos basados en la lógica en inglés.', ce: 'IN.C.E.3.3' }
            ],
            'Religión': [
                { activity: 'Análisis de dilemas éticos y sus consecuencias lógicas.', ce: 'RE.C.E.1.2' },
                { activity: 'Construcción de una narrativa que ilustre la conexión entre valores y acción.', ce: 'RE.C.E.1.2' },
                { activity: 'Investigación sobre la influencia de las matemáticas en la cultura.', ce: 'RE.C.E.1.3' }
            ],
            'Ampliación de Cultura Clásica': [
                { activity: 'Análisis de la lógica en los silogismos de Aristóteles.', ce: 'CC.C.E.1.3' },
                { activity: 'Estudio de la geometría en la arquitectura clásica.', ce: 'CC.C.E.1.3' },
                { activity: 'Resolución de un problema de lógica de la antigua Grecia.', ce: 'CC.C.E.1.3' },
            ],
            'Economía': [
                { activity: 'Modelado de la oferta y la demanda con funciones matemáticas.', ce: 'ECON.C.E.1.2' },
                { activity: 'Cálculo del interés compuesto para un plan de ahorro.', ce: 'ECON.C.E.1.2' },
                { activity: 'Análisis de la eficiencia de un proceso de producción.', ce: 'ECON.C.E.1.2' },
            ],
            'Latín': [
                { activity: 'Análisis de la estructura gramatical del latín como un sistema lógico.', ce: 'LA.C.E.1.2' },
                { activity: 'Resolución de un problema de lógica simple de la antigua Roma.', ce: 'LA.C.E.1.2' },
                { activity: 'Estudio de los números romanos y sus operaciones.', ce: 'LA.C.E.1.2' },
            ],
            'Francés': [
                { activity: 'Juego de lógica con vocabulario en francés.', ce: 'FR.C.E.3.3' },
                { activity: 'Resolución de crucigramas de lógica en francés.', ce: 'FR.C.E.3.3' },
                { activity: 'Análisis de la estructura de un diálogo en francés.', ce: 'FR.C.E.3.3' }
            ],
            'Música': [
                { activity: 'Identificación de patrones rítmicos y su representación numérica.', ce: 'MU.C.E.1.3' },
                { activity: 'Creación de una partitura con un patrón numérico o geométrico.', ce: 'MU.C.E.1.3' },
                { activity: 'Análisis de la armonía musical usando relaciones matemáticas.', ce: 'MU.C.E.1.3' }
            ],
            // NUEVAS ACTIVIDADES PARA EDUCACIÓN FÍSICA
            'Educación Física': [
                { activity: 'Cálculo de ángulos y trayectorias en lanzamientos y golpeos.', ce: 'EF.C.E.2.1' },
                { activity: 'Análisis estadístico de resultados deportivos y rendimiento físico.', ce: 'EF.C.E.3.2' },
                { activity: 'Medición y cálculo de distancias, tiempos y velocidades en actividades deportivas.', ce: 'EF.C.E.1.1' },
                { activity: 'Planificación de entrenamientos usando proporciones y porcentajes.', ce: 'EF.C.E.4.1' }
            ]
        };

        const NUM_WEEKS = 36; // Nueva duración del curso

        const scheduleData = [];
        let sequenceIndex = 0;
        const weekDates = [];
        
        // PRIMERA EVALUACIÓN: 14 semanas desde el 15 de septiembre de 2025
        let currentDay = new Date('2025-09-15T00:00:00'); 
        for (let i = 0; i < 14; i++) {
            const start = new Date(currentDay);
            const end = new Date(currentDay);
            end.setDate(currentDay.getDate() + 4); 
            weekDates.push({ start, end });
            
            currentDay.setDate(currentDay.getDate() + 7);

            const mathActivities = activitiesBySubject['Matemáticas'];
            const mathActivity = mathActivities[Math.floor(Math.random() * mathActivities.length)];
            
            const session2Subject = sessionSequence[sequenceIndex++];
            const session3Subject = sessionSequence[sequenceIndex++];

            const session2Activities = activitiesBySubject[session2Subject];
            const session3Activities = activitiesBySubject[session3Subject];

            const session2Activity = session2Activities[Math.floor(Math.random() * session2Activities.length)];
            const session3Activity = session3Activities[Math.floor(Math.random() * session3Activities.length)];
            
            scheduleData.push({
                week: i + 1,
                session1: {
                    subject: 'Matemáticas',
                    ambito: 'CT',
                    activity: mathActivity.activity,
                    ce: mathActivity.ce
                },
                session2: {
                    subject: session2Subject,
                    ambito: subjects[session2Subject].ambito === 'CT' ? 'CT' : subjects[session2Subject].ambito,
                    activity: session2Activity.activity,
                    ce: session2Activity.ce
                },
                session3: {
                    subject: session3Subject,
                    ambito: subjects[session3Subject].ambito === 'CT' ? 'CT' : subjects[session3Subject].ambito,
                    activity: session3Activity.activity,
                    ce: session3Activity.ce
                }
            });
        }
        
        // SEGUNDA EVALUACIÓN: 11 semanas desde el 12 de enero de 2026
        currentDay = new Date('2026-01-12T00:00:00');
        for (let i = 0; i < 11; i++) {
            const start = new Date(currentDay);
            const end = new Date(currentDay);
            end.setDate(currentDay.getDate() + 4); 
            weekDates.push({ start, end });
            
            currentDay.setDate(currentDay.getDate() + 7);

            const mathActivities = activitiesBySubject['Matemáticas'];
            const mathActivity = mathActivities[Math.floor(Math.random() * mathActivities.length)];
            
            const session2Subject = sessionSequence[sequenceIndex++];
            const session3Subject = sessionSequence[sequenceIndex++];

            const session2Activities = activitiesBySubject[session2Subject];
            const session3Activities = activitiesBySubject[session3Subject];

            const session2Activity = session2Activities[Math.floor(Math.random() * session2Activities.length)];
            const session3Activity = session3Activities[Math.floor(Math.random() * session3Activities.length)];
            
            scheduleData.push({
                week: i + 15, // Semanas 15-25
                session1: {
                    subject: 'Matemáticas',
                    ambito: 'CT',
                    activity: mathActivity.activity,
                    ce: mathActivity.ce
                },
                session2: {
                    subject: session2Subject,
                    ambito: subjects[session2Subject].ambito === 'CT' ? 'CT' : subjects[session2Subject].ambito,
                    activity: session2Activity.activity,
                    ce: session2Activity.ce
                },
                session3: {
                    subject: session3Subject,
                    ambito: subjects[session3Subject].ambito === 'CT' ? 'CT' : subjects[session3Subject].ambito,
                    activity: session3Activity.activity,
                    ce: session3Activity.ce
                }
            });
        }
        
        // TERCERA EVALUACIÓN: 11 semanas desde el 6 de abril de 2026
        currentDay = new Date('2026-04-06T00:00:00');
        for (let i = 0; i < 11; i++) {
            const start = new Date(currentDay);
            const end = new Date(currentDay);
            end.setDate(currentDay.getDate() + 4); 
            weekDates.push({ start, end });
            
            currentDay.setDate(currentDay.getDate() + 7);

            const mathActivities = activitiesBySubject['Matemáticas'];
            const mathActivity = mathActivities[Math.floor(Math.random() * mathActivities.length)];
            
            const session2Subject = sessionSequence[sequenceIndex++];
            const session3Subject = sessionSequence[sequenceIndex++];

            const session2Activities = activitiesBySubject[session2Subject];
            const session3Activities = activitiesBySubject[session3Subject];

            const session2Activity = session2Activities[Math.floor(Math.random() * session2Activities.length)];
            const session3Activity = session3Activities[Math.floor(Math.random() * session3Activities.length)];
            
            scheduleData.push({
                week: i + 26, // Semanas 26-36
                session1: {
                    subject: 'Matemáticas',
                    ambito: 'CT',
                    activity: mathActivity.activity,
                    ce: mathActivity.ce
                },
                session2: {
                    subject: session2Subject,
                    ambito: subjects[session2Subject].ambito === 'CT' ? 'CT' : subjects[session2Subject].ambito,
                    activity: session2Activity.activity,
                    ce: session2Activity.ce
                },
                session3: {
                    subject: session3Subject,
                    ambito: subjects[session3Subject].ambito === 'CT' ? 'CT' : subjects[session3Subject].ambito,
                    activity: session3Activity.activity,
                    ce: session3Activity.ce
                }
            });
        }
        
        // ACTUALIZADO: Añadido color para Educación Física
        const subjectColors = {
            'Matemáticas': '#4F46E5', 'Lengua': '#F97316', 'Geografía e Historia': '#8B5CF6',
            'Inglés': '#EC4899', 'Religión': '#6B7280', 'Ampliación de Cultura Clásica': '#06B6D4',
            'Economía': '#10B981', 'Latín': '#F59E0B', 'Francés': '#D946EF', 'Música': '#EF4444',
            'Educación Física': '#22C55E' // NUEVO COLOR
        };

        function toggleEvaluation(evaluationNumber) {
            const content = document.getElementById(`evaluation-content-${evaluationNumber}`);
            const icon = document.getElementById(`toggle-icon-${evaluationNumber}`);
            content.classList.toggle('hidden-content');
            if (content.classList.contains('hidden-content')) {
                icon.textContent = '+';
            } else {
                icon.textContent = '-';
            }
        }
        window.toggleEvaluation = toggleEvaluation;

        document.addEventListener('DOMContentLoaded', () => {
            const subjectFiltersContainer = document.getElementById('subject-filters');
            const ambitoFiltersContainer = document.getElementById('ambito-filters');
            const resetBtn = document.getElementById('reset-filters');
            
            // Aseguramos que 'Matemáticas' aparece una sola vez en los filtros
            const allSubjects = Object.keys(subjects).sort();
            const allAmbitos = [...new Set(Object.values(subjects).map(s => s.ambito))].sort();

            function createFilterButtons(container, items, type) {
                items.forEach(item => {
                    const button = document.createElement('button');
                    button.textContent = item;
                    button.dataset.filter = item;
                    button.dataset.type = type;
                    button.className = 'filter-btn px-4 py-1.5 text-sm font-medium text-gray-700 bg-gray-100 rounded-full hover:bg-gray-200';
                    container.appendChild(button);
                });
            }

            function renderSchedule(data, containerId) {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                // Opciones de formato de fecha
                const dateOptions = { day: 'numeric', month: 'long' };

                data.forEach(weekData => {
                    const weekCard = document.createElement('div');
                    weekCard.className = 'week-card bg-white rounded-2xl shadow-sm p-5';
                    weekCard.dataset.week = weekData.week;

                    // Formato de fechas: "del 15 de septiembre al 19 de septiembre" (Lunes a Viernes)
                    const startDate = weekDates[weekData.week - 1].start.toLocaleDateString('es-ES', dateOptions);
                    const endDate = weekDates[weekData.week - 1].end.toLocaleDateString('es-ES', dateOptions);
                    const dateRange = `del ${startDate} al ${endDate}`; // Ahora es Lunes a Viernes

                    weekCard.innerHTML = `
                        <h3 class="text-xl font-bold text-indigo-700 mb-2">Semana ${weekData.week}</h3>
                        <p class="text-sm text-gray-500 mb-4">${dateRange}</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            ${createSessionCard(weekData.session1, 1, weekData.week)}
                            ${createSessionCard(weekData.session2, 2, weekData.week)}
                            ${createSessionCard(weekData.session3, 3, weekData.week)}
                        </div>
                    `;
                    container.appendChild(weekCard);
                });
            }

            // Función actualizada para aceptar el número de semana
            function createSessionCard(session, sessionNumber, weekNumber) {
                const link = sessionLinks[weekNumber] ? sessionLinks[weekNumber][sessionNumber] : '#';

                return `
                    <div class="session-card rounded-xl p-4 border border-gray-200 transition-all duration-300" 
                         data-subject="${session.subject}" data-ambito="${session.ambito}"
                         style="border-left: 5px solid ${subjectColors[session.subject] || '#6B7280'};">
                        <p class="font-semibold text-sm text-gray-500">Sesión ${sessionNumber}</p>
                        <p class="font-bold text-gray-800">${session.subject}</p>
                        <p class="text-sm text-gray-600 mt-2">${session.activity}</p>
                        <p class="text-xs text-gray-400 mt-3 font-mono">Criterio de Evaluación: ${session.ce}</p>
                        
                        <!-- Botón de Registro de Evidencia con enlace funcional -->
                        <div class="mt-4 pt-3 border-t border-gray-100">
                            <a href="${link}" target="_blank" rel="noopener noreferrer"
                                class="w-full block text-center text-sm font-semibold px-3 py-1.5 rounded-lg 
                                bg-teal-500 text-white hover:bg-teal-600 transition duration-150 shadow-md">
                                Registrar evidencia
                            </a>
                        </div>
                    </div>
                `;
            }
            
            function applyFilter(filterValue, filterType) {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active', 'bg-indigo-600', 'text-white', 'hover:bg-indigo-700'));
                const activeButton = document.querySelector(`.filter-btn[data-filter="${filterValue}"][data-type="${filterType}"]`);
                if (activeButton) {
                    activeButton.classList.add('active', 'bg-indigo-600', 'text-white', 'hover:bg-indigo-700');
                }

                document.querySelectorAll('.week-card').forEach(weekCard => {
                    let weekHasMatch = false;
                    weekCard.querySelectorAll('.session-card').forEach(sessionCard => {
                        const isMatch = sessionCard.dataset[filterType] === filterValue;
                        if (isMatch) {
                            sessionCard.classList.remove('opacity-40');
                            sessionCard.classList.add('highlight');
                            weekHasMatch = true;
                        } else {
                            sessionCard.classList.add('opacity-40');
                            sessionCard.classList.remove('highlight');
                        }
                    });
                    
                    if (weekHasMatch) {
                        weekCard.classList.remove('filtered-out');
                    } else {
                        weekCard.classList.add('filtered-out');
                    }
                });
            }

            function resetFilters() {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active', 'bg-indigo-600', 'text-white', 'hover:bg-indigo-700'));
                document.querySelectorAll('.week-card').forEach(card => card.classList.remove('filtered-out'));
                document.querySelectorAll('.session-card').forEach(card => card.classList.remove('opacity-40', 'highlight'));
            }

            function renderChart() {
                const ctx = document.getElementById('proportionalityChart').getContext('2d');
                const sessionCounts = subjectSessions;
                
                const sortedSubjects = Object.keys(subjectSessions).sort((a, b) => subjectSessions[b] - subjectSessions[a]);
                const labels = sortedSubjects;
                const data = sortedSubjects.map(subject => subjectSessions[subject]);
                const backgroundColors = sortedSubjects.map(subject => subjectColors[subject] || '#6B7280');

                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Nº de Sesiones',
                            data: data,
                            backgroundColor: backgroundColors,
                            borderColor: '#FDFBF8',
                            borderWidth: 3,
                            hoverOffset: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: {
                                        family: 'Inter',
                                        size: 12
                                    },
                                    boxWidth: 15,
                                    padding: 15
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            label += context.parsed + ' sesiones';
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            createFilterButtons(subjectFiltersContainer, allSubjects, 'subject');
            createFilterButtons(ambitoFiltersContainer, allAmbitos, 'ambito');
            
            // --- NUEVOS RANGOS DE EVALUACIÓN CON FECHAS ESPECÍFICAS ---
            // 1ª Eval: Semanas 1-14 (15 septiembre)
            // 2ª Eval: Semanas 15-25 (12 enero) 
            // 3ª Eval: Semanas 26-36 (6 abril)

            renderSchedule(scheduleData.slice(0, 14), 'evaluation-content-1');
            renderSchedule(scheduleData.slice(14, 25), 'evaluation-content-2');
            renderSchedule(scheduleData.slice(25, 36), 'evaluation-content-3');

            renderChart();
            
            document.getElementById('controls').addEventListener('click', (e) => {
                if (e.target.classList.contains('filter-btn')) {
                    const { filter, type } = e.target.dataset;
                    applyFilter(filter, type);
                }
            });

            resetBtn.addEventListener('click', resetFilters);
        });
    </script>
</body>
</html>