<!DOCTYPE html>
<html lang="es">
<head>
	<link rel="manifest" href="./manifest.json" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Favicon añadido -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <title>Plan Interactivo de Razonamiento Matemático - 4º ESO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #4A4A4A;
        }
        .filter-btn {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .filter-btn.active {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .week-card {
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
            transform: scale(1);
        }
        .week-card.filtered-out {
            display: none;
            opacity: 0;
            transform: scale(0.98);
        }
        .session-card {
            transition: transform 0.3s ease-in-out;
        }
        .session-card.highlight {
            transform: scale(1.05);
            box-shadow: 0 0 0 2px #4F46E5;
        }
        .hidden-content {
            display: none;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">

        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Plan Interdisciplinar de Razonamiento Matemático</h1>
            <p class="mt-2 text-lg text-gray-600">4º ESO - Itinerario de Ciclos Formativos</p>
        </header>

        <main>
            <section id="controls" class="mb-12 p-6 bg-white rounded-2xl shadow-sm">
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Filtrar por Asignatura</h3>
                    <div id="subject-filters" class="flex flex-wrap gap-2"></div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Filtrar por Ámbito</h3>
                    <div id="ambito-filters" class="flex flex-wrap gap-2"></div>
                </div>
                 <div class="mt-6 text-center">
                    <button id="reset-filters" class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75 transition">Mostrar Todo</button>
                </div>
            </section>
            
            <section id="summary" class="mb-12">
                 <div class="bg-white rounded-2xl shadow-sm p-6">
                    <h2 class="text-xl font-bold text-gray-800 text-center mb-4">Distribución Proporcional de Sesiones</h2>
                    <p class="text-center text-gray-600 mb-6 max-w-2xl mx-auto">
                        Este gráfico ilustra la distribución de las 72 sesiones (Sesión 2 y 3) a lo largo del ciclo de <strong>36 semanas</strong>. La asignación es directamente proporcional a la carga horaria semanal de cada materia, garantizando un reparto equitativo del trabajo interdisciplinar.
                    </p>
                    <div class="chart-container relative w-full max-w-lg mx-auto h-80 md:h-96">
                        <canvas id="proportionalityChart"></canvas>
                    </div>
                </div>
            </section>

            <section id="schedule">
                <h2 class="text-2xl font-bold text-gray-800 text-center mb-8">Cronograma del Curso Escolar (36 Semanas)</h2>
                <div id="evaluations-container" class="space-y-6">
                    <!-- Primera Evaluación (14 semanas: S1-S14) -->
                    <div class="evaluation-section bg-white rounded-2xl shadow-sm overflow-hidden">
                        <button class="w-full text-left p-6 flex justify-between items-center cursor-pointer focus:outline-none" onclick="toggleEvaluation(1)">
                            <h3 class="text-xl font-bold text-gray-800">Primera Evaluación (Semanas 1-14)</h3>
                            <span id="toggle-icon-1" class="text-2xl font-bold transform transition-transform duration-300">+</span>
                        </button>
                        <div id="evaluation-content-1" class="p-5 border-t border-gray-200 space-y-6 hidden-content">
                            <!-- Las semanas se renderizarán aquí -->
                        </div>
                    </div>
                    <!-- Segunda Evaluación (11 semanas: S15-S25) -->
                    <div class="evaluation-section bg-white rounded-2xl shadow-sm overflow-hidden">
                        <button class="w-full text-left p-6 flex justify-between items-center cursor-pointer focus:outline-none" onclick="toggleEvaluation(2)">
                            <h3 class="text-xl font-bold text-gray-800">Segunda Evaluación (Semanas 15-25)</h3>
                            <span id="toggle-icon-2" class="text-2xl font-bold transform transition-transform duration-300">+</span>
                        </button>
                        <div id="evaluation-content-2" class="p-5 border-t border-gray-200 space-y-6 hidden-content">
                            <!-- Las semanas se renderizarán aquí -->
                        </div>
                    </div>
                    <!-- Tercera Evaluación (11 semanas: S26-S36) -->
                    <div class="evaluation-section bg-white rounded-2xl shadow-sm overflow-hidden">
                        <button class="w-full text-left p-6 flex justify-between items-center cursor-pointer focus:outline-none" onclick="toggleEvaluation(3)">
                            <h3 class="text-xl font-bold text-gray-800">Tercera Evaluación (Semanas 26-36)</h3>
                            <span id="toggle-icon-3" class="text-2xl font-bold transform transition-transform duration-300">+</span>
                        </button>
                        <div id="evaluation-content-3" class="p-5 border-t border-gray-200 space-y-6 hidden-content">
                            <!-- Las semanas se renderizarán aquí -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // *** CONFIGURACIÓN PARA 36 SEMANAS ***
        const TOTAL_WEEKS = 36;
        const WEEKS_EVAL1 = 14; // S1 al S14 (15/sept - 19/dic)
        const WEEKS_EVAL2 = 11; // S15 al S25 (12/ene - 27/mar)
        const WEEKS_EVAL3 = 11; // S26 al S36 (6/abr - 19/jun)
        
        // Definición de las materias y sus horas de docencia directa
        const subjects = {
            'Lengua': { hours: 4, ambito: 'SL' },
            'Geografía': { hours: 3, ambito: 'SL' },
            'Inglés': { hours: 4, ambito: 'SL' },
            'Religión': { hours: 1, ambito: 'SL' },
            'Matemáticas': { hours: 4, ambito: 'CT' },
            'Tecnología': { hours: 3, ambito: 'CT' },
            'Cultura Científica': { hours: 2, ambito: 'CT' },
            'Expresión Artística': { hours: 3, ambito: 'AR' },
            'Música': { hours: 3, ambito: 'AR' },
            'Dibujo Técnico': { hours: 2, ambito: 'AR' },
            'Educación Física': { hours: 2, ambito: 'AR' }
        };

        // Calcular sesiones por materia de forma simplificada
        function calculateSessions(subjectsObj, totalSessions, isCT = false) {
            const result = {};
            let totalHours = 0;
            
            // Calcular horas totales
            Object.keys(subjectsObj).forEach(key => {
                if (isCT && subjectsObj[key].ambito === 'CT') {
                    // Para CT, Matemáticas solo cuenta 2 horas en sesión 2
                    if (key === 'Matemáticas') {
                        totalHours += 2;
                    } else {
                        totalHours += subjectsObj[key].hours;
                    }
                } else if (!isCT && subjectsObj[key].ambito !== 'CT') {
                    totalHours += subjectsObj[key].hours;
                }
            });
            
            // Calcular sesiones para cada materia
            Object.keys(subjectsObj).forEach(key => {
                if ((isCT && subjectsObj[key].ambito === 'CT') || (!isCT && subjectsObj[key].ambito !== 'CT')) {
                    let hours = subjectsObj[key].hours;
                    // Ajuste para Matemáticas en sesión CT
                    if (isCT && key === 'Matemáticas') {
                        hours = 2;
                    }
                    
                    const sessions = Math.round((hours / totalHours) * totalSessions);
                    result[key] = sessions;
                }
            });
            
            // Ajustar para que la suma sea exactamente totalSessions
            let currentTotal = Object.values(result).reduce((a, b) => a + b, 0);
            let difference = totalSessions - currentTotal;
            
            if (difference !== 0) {
                const keys = Object.keys(result);
                let i = 0;
                while (difference !== 0) {
                    const key = keys[i % keys.length];
                    if (difference > 0) {
                        result[key]++;
                        difference--;
                    } else if (difference < 0 && result[key] > 0) {
                        result[key]--;
                        difference++;
                    }
                    i++;
                }
            }
            
            return result;
        }

        // Calcular sesiones para CT y SL_AR
        const sessionsCT = calculateSessions(subjects, TOTAL_WEEKS, true);
        const sessionsSL_AR = calculateSessions(subjects, TOTAL_WEEKS, false);

        // Función simple para distribuir sesiones
        function distributeSessionsSimple(sessionsObj, totalWeeks) {
            const result = [];
            const subjects = Object.keys(sessionsObj);
            
            // Crear array con todas las sesiones
            const allSessions = [];
            subjects.forEach(subject => {
                for (let i = 0; i < sessionsObj[subject]; i++) {
                    allSessions.push(subject);
                }
            });
            
            // Distribución simple round-robin
            for (let i = 0; i < totalWeeks; i++) {
                const index = i % allSessions.length;
                result.push(allSessions[index]);
            }
            
            return result;
        }

        // Generar secuencias
        const sessionSequenceCT = distributeSessionsSimple(sessionsCT, TOTAL_WEEKS);
        const sessionSequenceSL_AR = distributeSessionsSimple(sessionsSL_AR, TOTAL_WEEKS);

        // Definición de actividades
        const activitiesBySubject = {
            'Matemáticas': [
                { activity: 'Análisis de datos de producción y consumo para un proyecto tecnológico.', ce: 'MA.C.E.2.3' },
                { activity: 'Modelado de la trayectoria de un robot con funciones matemáticas.', ce: 'MA.C.E.3.1' },
                { activity: 'Resolución de problemas de proporcionalidad en la construcción de maquetas.', ce: 'MA.C.E.1.2' },
                { activity: 'Análisis de la eficiencia energética de un sistema usando datos estadísticos.', ce: 'MA.C.E.4.4' }
            ],
            'Tecnología': [
                { activity: 'Aplicación de la lógica para el diseño de un circuito eléctrico simple.', ce: 'TE.C.E.1.1' },
                { activity: 'Planificación de un proyecto tecnológico en un diagrama de flujo.', ce: 'TE.C.E.2.2' },
                { activity: 'Optimización de recursos para la fabricación de un objeto.', ce: 'TE.C.E.3.3' },
                { activity: 'Análisis del funcionamiento de un sistema mecánico a través de un esquema.', ce: 'TE.C.E.1.1' }
            ],
            'Cultura Científica': [
                { activity: 'Análisis de la fiabilidad de fuentes de información científica.', ce: 'CCF.C.E.1.1' },
                { activity: 'Interpretación de gráficos de datos sobre el cambio climático.', ce: 'CCF.C.E.2.1' },
                { activity: 'Resolución de un problema lógico en el contexto de una investigación científica.', ce: 'CCF.C.E.3.2' },
                { activity: 'Análisis de la influencia de la tecnología en la sociedad a través de datos.', ce: 'CCF.C.E.4.3' }
            ],
            'Lengua': [
                { activity: 'Identificación de falacias lógicas en un discurso político.', ce: 'LCL.C.E.1.4' },
                { activity: 'Organización de ideas para un debate siguiendo una estructura argumentativa.', ce: 'LCL.C.E.4.2' },
                { activity: 'Creación de un texto que justifique una opinión con razonamientos sólidos.', ce: 'LCL.C.E.5.3' },
                { activity: 'Análisis de la coherencia y cohesión de un párrafo.', ce: 'LCL.C.E.1.4' }
            ],
            'Geografía': [
                { activity: 'Interpretación de mapas temáticos (densidad de población, PIB).', ce: 'GEH.C.E.1.1' },
                { activity: 'Cálculo y análisis de la huella ecológica de una población.', ce: 'GEH.C.E.3.2' },
                { activity: 'Proyección del crecimiento demográfico a partir de datos históricos.', ce: 'GEH.C.E.2.4' },
                { activity: 'Análisis de patrones de migración a través de un diagrama de flujo.', ce: 'GEH.C.E.1.1' }
            ],
            'Inglés': [
                { activity: 'Resolución de problemas lógicos y acertijos en inglés.', ce: 'IN.C.E.3.3' },
                { activity: 'Análisis de la estructura lógica de un texto argumentativo en inglés.', ce: 'IN.C.E.4.2' },
                { activity: 'Elaboración de un árbol de decisión para una situación en inglés.', ce: 'IN.C.E.4.2' },
                { activity: 'Decodificación de mensajes secretos basados en la lógica en inglés.', ce: 'IN.C.E.3.3' }
            ],
            'Religión': [
                { activity: 'Análisis de dilemas éticos y sus consecuencias lógicas.', ce: 'RE.C.E.1.2' },
                { activity: 'Construcción de una narrativa que ilustre la conexión entre valores y acción.', ce: 'RE.C.E.1.2' },
                { activity: 'Investigación sobre la influencia de las matemáticas en la cultura.', ce: 'RE.C.E.1.3' }
            ],
            'Expresión Artística': [
                { activity: 'Aplicación de la proporción áurea para la composición de una obra de arte.', ce: 'EA.C.E.1.2' },
                { activity: 'Análisis de la estructura geométrica en una obra de arte cubista.', ce: 'EA.C.E.1.2' },
                { activity: 'Uso de la perspectiva lineal para crear una imagen 3D.', ce: 'EA.C.E.1.2' }
            ],
            'Música': [
                { activity: 'Identificación de patrones rítmicos y su representación numérica.', ce: 'MU.C.E.1.3' },
                { activity: 'Creación de una partitura con un patrón numérico o geométrico.', ce: 'MU.C.E.1.3' },
                { activity: 'Análisis de la armonía musical usando relaciones matemáticas.', ce: 'MU.C.E.1.3' }
            ],
            'Dibujo Técnico': [
                { activity: 'Proyección de vistas ortogonales de un objeto.', ce: 'DT.C.E.1.2' },
                { activity: 'Diseño de un objeto en 3D usando software de CAD.', ce: 'DT.C.E.2.1' },
                { activity: 'Cálculo de la superficie de una figura compleja.', ce: 'DT.C.E.3.1' }
            ],
            'Educación Física': [
                { activity: 'Análisis de la cinemática de un salto usando datos de movimiento.', ce: 'EF.C.E.1.2' },
                { activity: 'Estrategia de juego en deportes colectivos con diagramas de flujo.', ce: 'EF.C.E.2.1' },
                { activity: 'Planificación de un circuito de entrenamiento para optimizar un resultado.', ce: 'EF.C.E.3.1' }
            ]
        };

        // Generar datos del cronograma
        const scheduleData = [];
        const weekDates = [];
        
        // Fecha de inicio
        let currentDate = new Date('2025-09-15');
        
        for (let week = 1; week <= TOTAL_WEEKS; week++) {
            // Calcular fechas de la semana
            const start = new Date(currentDate);
            const end = new Date(currentDate);
            end.setDate(start.getDate() + 4); // Lunes a viernes
            
            weekDates.push({
                start: new Date(start),
                end: new Date(end)
            });
            
            // Avanzar a la siguiente semana
            currentDate.setDate(currentDate.getDate() + 7);
            
            // Ajustes para vacaciones
            if (week === WEEKS_EVAL1) {
                currentDate = new Date('2026-01-12');
            } else if (week === WEEKS_EVAL1 + WEEKS_EVAL2) {
                currentDate = new Date('2026-04-06');
            }
            
            // Obtener materias para esta semana
            const session2Subject = sessionSequenceCT[week - 1];
            const session3Subject = sessionSequenceSL_AR[week - 1];
            
            // Seleccionar actividades aleatorias
            const mathActivity = activitiesBySubject['Matemáticas'][
                Math.floor(Math.random() * activitiesBySubject['Matemáticas'].length)
            ];
            
            const session2Activity = activitiesBySubject[session2Subject][
                Math.floor(Math.random() * activitiesBySubject[session2Subject].length)
            ];
            
            const session3Activity = activitiesBySubject[session3Subject][
                Math.floor(Math.random() * activitiesBySubject[session3Subject].length)
            ];
            
            scheduleData.push({
                week: week,
                session1: {
                    subject: 'Matemáticas',
                    ambito: 'CT',
                    activity: mathActivity.activity,
                    ce: mathActivity.ce
                },
                session2: {
                    subject: session2Subject,
                    ambito: subjects[session2Subject].ambito,
                    activity: session2Activity.activity,
                    ce: session2Activity.ce
                },
                session3: {
                    subject: session3Subject,
                    ambito: subjects[session3Subject].ambito,
                    activity: session3Activity.activity,
                    ce: session3Activity.ce
                }
            });
        }

        const subjectColors = {
            'Matemáticas': '#4F46E5', 'Tecnología': '#10B981', 'Cultura Científica': '#0EA5E9',
            'Lengua': '#F97316', 'Geografía': '#8B5CF6', 'Inglés': '#EC4899',
            'Religión': '#6B7280', 'Expresión Artística': '#D946EF', 'Música': '#F59E0B',
            'Dibujo Técnico': '#EF4444', 'Educación Física': '#3B82F6'
        };

        function toggleEvaluation(evaluationNumber) {
            const content = document.getElementById(`evaluation-content-${evaluationNumber}`);
            const icon = document.getElementById(`toggle-icon-${evaluationNumber}`);
            content.classList.toggle('hidden-content');
            if (content.classList.contains('hidden-content')) {
                icon.textContent = '+';
            } else {
                icon.textContent = '-';
            }
        }
        window.toggleEvaluation = toggleEvaluation;

        document.addEventListener('DOMContentLoaded', () => {
            const subjectFiltersContainer = document.getElementById('subject-filters');
            const ambitoFiltersContainer = document.getElementById('ambito-filters');
            const resetBtn = document.getElementById('reset-filters');
            
            const allSubjects = Object.keys(subjects).sort();
            const allAmbitos = [...new Set(Object.values(subjects).map(s => s.ambito))].sort();

            function createFilterButtons(container, items, type) {
                items.forEach(item => {
                    const button = document.createElement('button');
                    button.textContent = item;
                    button.dataset.filter = item;
                    button.dataset.type = type;
                    button.className = 'filter-btn px-4 py-1.5 text-sm font-medium text-gray-700 bg-gray-100 rounded-full hover:bg-gray-200';
                    container.appendChild(button);
                });
            }

            function renderSchedule(data, containerId) {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                data.forEach(weekData => {
                    const weekCard = document.createElement('div');
                    weekCard.className = 'week-card bg-white rounded-2xl shadow-sm p-5';
                    weekCard.dataset.week = weekData.week;

                    const weekIndex = weekData.week - 1;
                    const options = { day: 'numeric', month: 'long' };
                    const startDate = weekDates[weekIndex].start.toLocaleDateString('es-ES', options);
                    const endDate = weekDates[weekIndex].end.toLocaleDateString('es-ES', options);
                    
                    const dateRange = `del ${startDate} al ${endDate}`;

                    weekCard.innerHTML = `
                        <h3 class="text-xl font-bold text-indigo-700 mb-2">Semana ${weekData.week}</h3>
                        <p class="text-sm text-gray-500 mb-4">${dateRange}</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            ${createSessionCard(weekData.session1, 1, weekData.week)}
                            ${createSessionCard(weekData.session2, 2, weekData.week)}
                            ${createSessionCard(weekData.session3, 3, weekData.week)}
                        </div>
                    `;
                    container.appendChild(weekCard);
                });
            }

            function createSessionCard(session, sessionNumber, weekNumber) {
                // Enlace simple - puedes ajustar esto según tus necesidades
                const link = "#";
                
                return `
                    <div class="session-card rounded-xl p-4 border border-gray-200 transition-all duration-300" 
                         data-subject="${session.subject}" data-ambito="${session.ambito}"
                         style="border-left: 5px solid ${subjectColors[session.subject] || '#6B7280'};">
                        <p class="font-semibold text-sm text-gray-500">Sesión ${sessionNumber}</p>
                        <p class="font-bold text-gray-800">${session.subject}</p>
                        <p class="text-sm text-gray-600 mt-2">${session.activity}</p>
                        <p class="text-xs text-gray-400 mt-3 font-mono">Criterio de Evaluación: ${session.ce}</p>
                        <a href="${link}" target="_blank" class="block mt-4 w-full py-1.5 text-sm font-semibold text-white bg-indigo-500 rounded-lg shadow-md hover:bg-indigo-600 transition duration-150 text-center">
                            Registrar evidencia
                        </a>
                    </div>
                `;
            }
            
            function applyFilter(filterValue, filterType) {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active', 'bg-indigo-600', 'text-white', 'hover:bg-indigo-700'));
                const activeButton = document.querySelector(`.filter-btn[data-filter="${filterValue}"][data-type="${filterType}"]`);
                if (activeButton) {
                    activeButton.classList.add('active', 'bg-indigo-600', 'text-white', 'hover:bg-indigo-700');
                }

                document.querySelectorAll('.week-card').forEach(weekCard => {
                    let weekHasMatch = false;
                    weekCard.querySelectorAll('.session-card').forEach(sessionCard => {
                        const isMatch = sessionCard.dataset[filterType] === filterValue;
                        if (isMatch) {
                            sessionCard.classList.remove('opacity-40');
                            sessionCard.classList.add('highlight');
                            weekHasMatch = true;
                        } else {
                            sessionCard.classList.add('opacity-40');
                            sessionCard.classList.remove('highlight');
                        }
                    });
                    
                    if (weekHasMatch) {
                        weekCard.classList.remove('filtered-out');
                    } else {
                        weekCard.classList.add('filtered-out');
                    }
                });
            }

            function resetFilters() {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active', 'bg-indigo-600', 'text-white', 'hover:bg-indigo-700'));
                document.querySelectorAll('.week-card').forEach(card => card.classList.remove('filtered-out'));
                document.querySelectorAll('.session-card').forEach(card => card.classList.remove('opacity-40', 'highlight'));
            }

            function renderChart() {
                const ctx = document.getElementById('proportionalityChart').getContext('2d');
                
                // Combinar sesiones CT y SL_AR
                const sessionCounts = {};
                Object.keys(sessionsCT).forEach(subject => {
                    sessionCounts[subject] = (sessionCounts[subject] || 0) + sessionsCT[subject];
                });
                Object.keys(sessionsSL_AR).forEach(subject => {
                    sessionCounts[subject] = (sessionCounts[subject] || 0) + sessionsSL_AR[subject];
                });
                
                const sortedSubjects = Object.keys(sessionCounts).sort((a, b) => sessionCounts[b] - sessionCounts[a]);
                const labels = sortedSubjects;
                const data = sortedSubjects.map(subject => sessionCounts[subject]);
                const backgroundColors = sortedSubjects.map(subject => subjectColors[subject] || '#6B7280');

                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Nº de Sesiones',
                            data: data,
                            backgroundColor: backgroundColors,
                            borderColor: '#FDFBF8',
                            borderWidth: 3,
                            hoverOffset: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: {
                                        family: 'Inter',
                                        size: 12
                                    },
                                    boxWidth: 15,
                                    padding: 15
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            label += context.parsed + ' sesiones';
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            createFilterButtons(subjectFiltersContainer, allSubjects, 'subject');
            createFilterButtons(ambitoFiltersContainer, allAmbitos, 'ambito');
            
            // Renderizar las semanas
            renderSchedule(scheduleData.slice(0, WEEKS_EVAL1), 'evaluation-content-1');
            renderSchedule(scheduleData.slice(WEEKS_EVAL1, WEEKS_EVAL1 + WEEKS_EVAL2), 'evaluation-content-2');
            renderSchedule(scheduleData.slice(WEEKS_EVAL1 + WEEKS_EVAL2, TOTAL_WEEKS), 'evaluation-content-3');

            renderChart();
            
            document.getElementById('controls').addEventListener('click', (e) => {
                if (e.target.classList.contains('filter-btn')) {
                    const { filter, type } = e.target.dataset;
                    applyFilter(filter, type);
                }
            });

            resetBtn.addEventListener('click', resetFilters);
        });
    </script>
</body>
</html>