<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Favicon añadido -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <title>Plan Interactivo de Razonamiento Matemático - 4º ESO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #4A4A4A;
        }
        .filter-btn {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .filter-btn.active {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .week-card {
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
            transform: scale(1);
        }
        .week-card.filtered-out {
            opacity: 0.15;
            transform: scale(0.98);
        }
        .session-card.highlight {
            transform: scale(1.05);
            box-shadow: 0 0 0 2px #4F46E5;
        }
        /* Estilo para el botón de acción */
        .evidence-btn {
            background-color: #10B981; /* Verde esmeralda */
            color: white;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 0.5rem; /* rounded-lg */
            font-size: 0.875rem; /* text-sm */
            display: block;
            width: 100%;
            text-align: center;
            margin-top: 12px;
            transition: background-color 0.2s;
            box-shadow: 0 2px 4px 0 rgba(16, 185, 129, 0.4);
            text-decoration: none;
        }
        .evidence-btn:hover {
            background-color: #059669; /* Verde oscuro al pasar el ratón */
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">

        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Plan de Razonamiento Matemático 4º ESO Ciencias</h1>
            <p class="mt-2 text-lg text-gray-600">Cronograma interactivo para 4º ESO de Ciencias (36 semanas)</p>
        </header>

        <main>
            <section id="controls" class="mb-12 p-6 bg-white rounded-2xl shadow-sm">
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Filtrar por Asignatura</h3>
                    <div id="subject-filters" class="flex flex-wrap gap-2"></div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Filtrar por Ámbito</h3>
                    <div id="ambito-filters" class="flex flex-wrap gap-2"></div>
                </div>
                 <div class="mt-6 flex flex-wrap justify-center gap-4">
                    <button id="reset-filters" class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75 transition">Mostrar Todo</button>
                </div>
            </section>
            
            <section id="summary" class="mb-12">
                 <div class="bg-white rounded-2xl shadow-sm p-6">
                    <h2 class="text-xl font-bold text-gray-800 text-center mb-4">Distribución Proporcional de Sesiones (36 Semanas)</h2>
                    <p class="text-center text-gray-600 mb-6 max-w-2xl mx-auto">
                        Este gráfico ilustra la distribución de las sesiones a lo largo del ciclo completo de 36 semanas. La asignación es directamente proporcional a la carga horaria semanal de cada materia, garantizando un reparto equitativo del trabajo interdisciplinar de razonamiento matemático.
                    </p>
                    <div class="chart-container relative w-full max-w-lg mx-auto h-80 md:h-96">
                        <canvas id="proportionalityChart"></canvas>
                    </div>
                </div>
            </section>

            <section id="schedule">
                <h2 class="text-2xl font-bold text-gray-800 text-center mb-8">Cronograma del Curso Escolar Completo</h2>
                <div id="evaluations-container" class="space-y-6">
                    <!-- Primera Evaluación (14 semanas) -->
                    <div class="evaluation-section bg-white rounded-2xl shadow-sm overflow-hidden">
                        <button class="w-full text-left p-6 flex justify-between items-center cursor-pointer focus:outline-none" onclick="toggleEvaluation(1)">
                            <h3 class="text-xl font-bold text-gray-800">Primera Evaluación (Semanas 1-14)</h3>
                            <span class="text-sm text-gray-500 hidden sm:inline-block">(15/sep - 19/dic)</span>
                            <span id="toggle-icon-1" class="text-2xl font-bold transform transition-transform duration-300">-</span>
                        </button>
                        <div id="evaluation-content-1" class="p-5 border-t border-gray-200 space-y-6">
                            <!-- Las semanas se renderizarán aquí -->
                        </div>
                    </div>
                    <!-- Segunda Evaluación (11 semanas) -->
                    <div class="evaluation-section bg-white rounded-2xl shadow-sm overflow-hidden">
                        <button class="w-full text-left p-6 flex justify-between items-center cursor-pointer focus:outline-none" onclick="toggleEvaluation(2)">
                            <h3 class="text-xl font-bold text-gray-800">Segunda Evaluación (Semanas 15-25)</h3>
                             <span class="text-sm text-gray-500 hidden sm:inline-block">(12/ene - 27/mar)</span>
                            <span id="toggle-icon-2" class="text-2xl font-bold transform transition-transform duration-300">+</span>
                        </button>
                        <div id="evaluation-content-2" class="p-5 border-t border-gray-200 space-y-6 hidden">
                            <!-- Las semanas se renderizarán aquí -->
                        </div>
                    </div>
                    <!-- Tercera Evaluación (11 semanas) -->
                    <div class="evaluation-section bg-white rounded-2xl shadow-sm overflow-hidden">
                        <button class="w-full text-left p-6 flex justify-between items-center cursor-pointer focus:outline-none" onclick="toggleEvaluation(3)">
                            <h3 class="text-xl font-bold text-gray-800">Tercera Evaluación (Semanas 26-36)</h3>
                            <span class="text-sm text-gray-500 hidden sm:inline-block">(06/abr - 19/jun)</span>
                            <span id="toggle-icon-3" class="text-2xl font-bold transform transition-transform duration-300">+</span>
                        </button>
                        <div id="evaluation-content-3" class="p-5 border-t border-gray-200 space-y-6 hidden">
                            <!-- Las semanas se renderizarán aquí -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // --- DATOS DE ENLACES DEL CSV ---
        const csvLinks = {
            1: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B5",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E5",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H5"
            },
            2: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B10",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E10",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H10"
            },
            3: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B17",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E17",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H17"
            },
            4: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B22",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E22",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H22"
            },
            5: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B27",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E27",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H27"
            },
            6: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B32",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E32",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H32"
            },
            7: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B37",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E37",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H37"
            },
            8: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B44",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E44",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H44"
            },
            9: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B49",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E49",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H49"
            },
            10: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B54",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E54",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H54"
            },
            11: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B59",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E59",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H59"
            },
            12: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B66",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E66",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H66"
            },
            13: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B71",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E71",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H71"
            },
            14: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B76",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E76",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H76"
            },
            15: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B83",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E83",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H83"
            },
            16: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B88",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E88",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H88"
            },
            17: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B93",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E93",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H93"
            },
            18: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B100",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E100",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H100"
            },
            19: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B105",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E105",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H105"
            },
            20: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B110",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E110",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H110"
            },
            21: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B115",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E115",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H115"
            },
            22: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B122",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E122",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H122"
            },
            23: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B127",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E127",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H127"
            },
            24: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B132",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E132",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H132"
            },
            25: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B137",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E137",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H137"
            },
            26: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B144",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E144",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H144"
            },
            27: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B149",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E149",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H149"
            },
            28: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B154",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E154",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H154"
            },
            29: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B159",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E159",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H159"
            },
            30: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B166",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E166",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H166"
            },
            31: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B171",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E171",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H171"
            },
            32: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B176",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E176",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H176"
            },
            33: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B181",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E181",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H181"
            },
            34: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B188",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E188",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H188"
            },
            35: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B193",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E193",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H193"
            },
            36: {
                1: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=B198",
                2: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=E198",
                3: "https://docs.google.com/spreadsheets/d/1QEYC3Hy4nR0dzS8Uil6-c7JkNtDdsvclR-lf_vBhkqA/edit?gid=302710808#gid=302710808&range=H198"
            }
        };

        // --- PARÁMETROS GLOBALES DEL PLAN ---
        // Carga horaria semanal de cada materia (se mantiene igual)
        const materiasHoras = {
            'Lengua': 4, 'Geografía': 3, 'Inglés': 4, 'Religión': 1,
            'Biología y Geología': 3, 'Física y Química': 3, 'Tecnología': 3, 'Cultura Científica': 2,
            'Dibujo Técnico': 2, 'Ed. Física': 2
        };
        const totalHorasSinMatematicas = Object.values(materiasHoras).reduce((sum, hours) => sum + hours, 0);
        
        // El nuevo total de semanas es 36
        const totalSemanas = 36;
        
        // Total de sesiones: 2 sesiones de razonamiento por semana * 36 semanas = 72 sesiones (Sesión 2 y 3)
        const totalSesiones = totalSemanas * 2; 

        // Coeficiente de sesiones por hora para mantener la proporcionalidad
        const sesionPorHora = totalSesiones / totalHorasSinMatematicas;

        // Distribución de Sesiones por Materia (proporcional a la carga horaria, se ajusta al nuevo total)
        const sesionesPorMateria = Object.keys(materiasHoras).reduce((acc, materia) => {
            // Utilizamos Math.round para asegurar que el total sume 72
            acc[materia] = Math.round(materiasHoras[materia] * sesionPorHora);
            return acc;
        }, {});
        
        // Ajuste fino para asegurar que el total sea exactamente 72, si el redondeo lo alteró.
        const sumOfCalculatedSessions = Object.values(sesionesPorMateria).reduce((a, b) => a + b, 0);
        if (sumOfCalculatedSessions !== totalSesiones) {
             // Si el total no es 72, ajustamos la materia con más sesiones.
             const subjectToAdjust = Object.keys(sesionesPorMateria).sort((a, b) => sesionesPorMateria[b] - sesionesPorMateria[a])[0];
             sesionesPorMateria[subjectToAdjust] += (totalSesiones - sumOfCalculatedSessions);
        }

        let materiasParaPlanificar = Object.keys(sesionesPorMateria).flatMap(materia => 
            Array(sesionesPorMateria[materia]).fill(materia)
        );
        materiasParaPlanificar = shuffleArray(materiasParaPlanificar);

        const ambitosMaterias = {
            'SL': ['Lengua', 'Geografía', 'Inglés', 'Religión'],
            'CT': ['Biología y Geología', 'Física y Química', 'Tecnología', 'Cultura Científica'],
            'AR': ['Dibujo Técnico', 'Ed. Física']
        };

        function getAmbito(materia) {
            for (const ambito in ambitosMaterias) {
                if (ambitosMaterias[ambito].includes(materia)) {
                    return ambito;
                }
            }
            return 'Desconocido';
        }

        // --- Generación del Cronograma (36 semanas) ---
        const scheduleData = [];
        for (let i = 1; i <= totalSemanas; i++) {
            const semanaData = { week: i, session1: { subject: 'Matemáticas', ambito: 'CT', activity: '', ce: '' } };

            // Sesión 2: Ámbito CT
            // Filtramos las materias CT disponibles y usamos la primera
            const ctMaterias = materiasParaPlanificar.filter(m => getAmbito(m) === 'CT');
            let sesion2Materia;
            if (ctMaterias.length > 0) {
                sesion2Materia = ctMaterias.shift();
                // Eliminamos la materia usada de la lista de pendientes
                materiasParaPlanificar.splice(materiasParaPlanificar.indexOf(sesion2Materia), 1);
            } else {
                sesion2Materia = 'Sin asignar';
            }
            semanaData.session2 = { subject: sesion2Materia, ambito: 'CT', activity: '', ce: '' };

            // Sesión 3: Ámbitos AR o SL
            // Filtramos las materias AR/SL disponibles y usamos la primera
            const arSlMaterias = materiasParaPlanificar.filter(m => ['AR', 'SL'].includes(getAmbito(m)));
            let sesion3Materia;
            if (arSlMaterias.length > 0) {
                sesion3Materia = arSlMaterias.shift();
                // Eliminamos la materia usada de la lista de pendientes
                materiasParaPlanificar.splice(materiasParaPlanificar.indexOf(sesion3Materia), 1);
            } else {
                sesion3Materia = 'Sin asignar';
            }
            semanaData.session3 = { subject: sesion3Materia, ambito: getAmbito(sesion3Materia), activity: '', ce: '' };
            
            scheduleData.push(semanaData);
        }

        const actividadesCE = {
            'Matemáticas': {
                'description': 'Modelización de problemas con funciones o ecuaciones.',
                'ce': 'MA.C.E.2.1. Aplicar las propiedades de los números y el álgebra en la resolución de problemas.'
            },
            'Biología y Geología': {
                'description': 'Análisis estadístico de datos genéticos.',
                'ce': 'BG.C.E.4.3. Interpretar la información genética y su transmisión a lo largo del tiempo.'
            },
            'Física y Química': {
                'description': 'Cálculo de trayectorias y optimización de recursos energéticos.',
                'ce': 'FQ.C.E.1.2. Resolver problemas relacionados con magnitudes cinemáticas y dinámicas.'
            },
            'Tecnología': {
                'description': 'Diseño de algoritmos para un robot o sistema domótico.',
                'ce': 'T.C.E.2.1. Programar sistemas automáticos simples.'
            },
            'Cultura Científica': {
                'description': 'Interpretación de modelos matemáticos que explican fenómenos naturales.',
                'ce': 'CC.C.E.1.1. Interpretar y valorar el conocimiento científico.'
            },
            'Lengua': {
                'description': 'Análisis de la estructura lógica de un texto argumentativo o un debate.',
                'ce': 'LCL.C.E.2.3. Producir textos coherentes y cohesionados.'
            },
            'Geografía': {
                'description': 'Interpretación de mapas temáticos con datos estadísticos de población.',
                'ce': 'GEH.C.E.1.1. Interpretar la diversidad territorial y socioeconómica.'
            },
            'Inglés': {
                'description': 'Creación de un juego de mesa con reglas lógicas complejas en inglés.',
                'ce': 'IN.C.E.4.4. Comunicarse con fluidez en la lengua extranjera.'
            },
            'Religión': {
                'description': 'Discusión de dilemas éticos bajo un marco de lógica formal.',
                'ce': 'RE.C.E.1.3. Analizar textos y mensajes religiosos con pensamiento crítico.'
            },
            'Dibujo Técnico': {
                'description': 'Resolución de problemas de visualización espacial en 3D.',
                'ce': 'DT.C.E.1.2. Representar objetos en el plano con diferentes proyecciones.'
            },
            'Ed. Física': {
                'description': 'Análisis de la estrategia óptima en un deporte de equipo.',
                'ce': 'EF.C.E.1.4. Aplicar los principios del juego colectivo a un deporte.'
            }
        };

        scheduleData.forEach(week => {
            week.session1.activity = actividadesCE['Matemáticas'].description;
            week.session1.ce = actividadesCE['Matemáticas'].ce;
            week.session2.activity = actividadesCE[week.session2.subject]?.description || 'Actividad por definir';
            week.session2.ce = actividadesCE[week.session2.subject]?.ce || 'CE por definir';
            week.session3.activity = actividadesCE[week.session3.subject]?.description || 'Actividad por definir';
            week.session3.ce = actividadesCE[week.session3.subject]?.ce || 'CE por definir';
        });

        const subjectColors = {
            'Matemáticas': '#4F46E5', 'Biología y Geología': '#10B981', 'Física y Química': '#0EA5E9', 'Tecnología': '#D946EF', 'Cultura Científica': '#F97316',
            'Lengua': '#EAB308', 'Geografía': '#8B5CF6', 'Inglés': '#EC4899', 'Religión': '#6B7280',
            'Dibujo Técnico': '#EF4444', 'Ed. Física': '#3B82F6', 'Sin asignar': '#374151'
        };
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Función para generar fechas de lunes a viernes
        function generateDates(start, totalWeeks) {
            const dates = [];
            let currentDay = new Date(start + 'T00:00:00Z'); // Usar 'Z' para UTC para evitar problemas de zona horaria

            // Función auxiliar para obtener el primer lunes después o en la fecha dada
            function getNextMonday(date) {
                const day = date.getDay(); // 0=Domingo, 1=Lunes, ...
                const diff = (day === 0) ? 1 : (8 - day) % 7; // Si es domingo (0), avanza 1 (lunes). Sino, avanza (8 - día) % 7 días
                const nextMonday = new Date(date);
                nextMonday.setDate(date.getDate() + diff);
                return nextMonday;
            }

            // Primer lunes de la primera semana de clase (15 de septiembre de 2025 es Lunes)
            if (currentDay.getDay() !== 1) { // Si la fecha de inicio no es lunes, ajustar al siguiente lunes.
                // Basado en el prompt, 15/sept/2025 es Lunes, por lo que no debería ser necesario el ajuste.
                currentDay = getNextMonday(currentDay); 
            }

            for (let i = 0; i < totalWeeks; i++) {
                // Fecha de inicio (Lunes)
                const startOfWeek = new Date(currentDay);

                // Fecha de fin (Viernes)
                const endOfWeek = new Date(currentDay);
                endOfWeek.setDate(currentDay.getDate() + 4); // Lunes + 4 días = Viernes

                dates.push({ start: startOfWeek, end: endOfWeek });

                // Avanzar al siguiente lunes (Lunes + 7 días)
                currentDay.setDate(currentDay.getDate() + 7);
            }
            return dates;
        }

        // Definición de las fechas de inicio para cada bloque de evaluación
        const blockDates = [
            // Primera Evaluación (14 semanas): 15/sep - 19/dic
            { start: '2025-09-15', weeks: 14, label: 'eval-1' }, 
            // Segunda Evaluación (11 semanas): 12/ene/2026 - 27/mar
            { start: '2026-01-12', weeks: 11, label: 'eval-2' }, 
            // Tercera Evaluación (11 semanas): 06/abr - 19/jun
            { start: '2026-04-06', weeks: 11, label: 'eval-3' }
        ];

        let weekDates = [];
        let weekCounter = 1;
        blockDates.forEach(block => {
            const blockStartDates = generateDates(block.start, block.weeks);
            blockStartDates.forEach(date => {
                weekDates.push({ 
                    week: weekCounter++, 
                    start: date.start, 
                    end: date.end 
                });
            });
        });
        
        // Función para cambiar el estado de la sección de evaluación
        function toggleEvaluation(evaluationNumber) {
            const content = document.getElementById(`evaluation-content-${evaluationNumber}`);
            const icon = document.getElementById(`toggle-icon-${evaluationNumber}`);
            content.classList.toggle('hidden');
            if (content.classList.contains('hidden')) {
                icon.textContent = '+';
            } else {
                icon.textContent = '-';
            }
        }
        window.toggleEvaluation = toggleEvaluation;

        // Función para renderizar el cronograma
        function renderSchedule(data, containerId, startWeekIndex) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            data.forEach((weekData, index) => {
                const weekIndex = startWeekIndex + index; // Índice en el array total (0 a 35)
                const weekCard = document.createElement('div');
                weekCard.className = 'week-card bg-white rounded-2xl shadow-sm p-5';
                weekCard.dataset.week = weekData.week;

                const datesInfo = weekDates.find(d => d.week === weekData.week);

                // Formato de fechas: lunes al viernes de (Día Mes) a (Día Mes)
                const startDay = datesInfo.start.toLocaleDateString('es-ES', { day: 'numeric', month: 'long' });
                const endDay = datesInfo.end.toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' });
                const dateRange = `del Lunes ${startDay} al Viernes ${endDay}`;

                weekCard.innerHTML = `
                    <h3 class="text-xl font-bold text-indigo-700 mb-2">Semana ${weekData.week}</h3>
                    <p class="text-sm text-gray-500 mb-4">${dateRange}</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        ${createSessionCard(weekData.session1, 1, weekData.week)}
                        ${createSessionCard(weekData.session2, 2, weekData.week)}
                        ${createSessionCard(weekData.session3, 3, weekData.week)}
                    </div>
                `;
                container.appendChild(weekCard);
            });
        }

        // Función para crear la ficha de sesión (MODIFICADA para incluir enlaces)
        function createSessionCard(session, sessionNumber, week) {
            const link = csvLinks[week] ? csvLinks[week][sessionNumber] : '#';
            return `
                <div class="session-card rounded-xl p-4 border border-gray-200 transition-all duration-300 flex flex-col justify-between" 
                     data-subject="${session.subject}" data-ambito="${session.ambito}"
                     style="border-left: 5px solid ${subjectColors[session.subject] || '#6B7280'};">
                    
                    <div>
                        <p class="font-semibold text-sm text-gray-500">Sesión ${sessionNumber}</p>
                        <p class="font-bold text-gray-800">${session.subject}</p>
                        <p class="text-sm text-gray-600 mt-2">${session.activity}</p>
                        <p class="text-xs text-gray-400 mt-3 font-mono">${session.ce}</p>
                    </div>

                    <!-- Botón "Registrar evidencia" con enlace del CSV -->
                    <a href="${link}" target="_blank" class="evidence-btn">
                        Registrar evidencia
                    </a>
                </div>
            `;
        }

        // Función para aplicar filtros (se mantiene igual, ya que solo es visual)
        function applyFilter(filterValue, filterType) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active', 'bg-indigo-600', 'text-white', 'hover:bg-indigo-700'));
            const activeButton = document.querySelector(`.filter-btn[data-filter="${filterValue}"][data-type="${filterType}"]`);
            if (activeButton) {
                activeButton.classList.add('active', 'bg-indigo-600', 'text-white', 'hover:bg-indigo-700');
            }

            document.querySelectorAll('.week-card').forEach(weekCard => {
                let weekHasMatch = false;
                weekCard.querySelectorAll('.session-card').forEach(sessionCard => {
                    const isMatch = sessionCard.dataset[filterType] === filterValue;
                    if (isMatch) {
                        sessionCard.classList.remove('opacity-40');
                        sessionCard.classList.add('highlight');
                        weekHasMatch = true;
                    } else {
                        sessionCard.classList.add('opacity-40');
                        sessionCard.classList.remove('highlight');
                    }
                });
                
                if (weekHasMatch) {
                    weekCard.classList.remove('filtered-out');
                } else {
                    weekCard.classList.add('filtered-out');
                }
            });
        }

        // Función para resetear filtros
        function resetFilters() {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active', 'bg-indigo-600', 'text-white', 'hover:bg-indigo-700'));
            document.querySelectorAll('.week-card').forEach(card => card.classList.remove('filtered-out'));
            document.querySelectorAll('.session-card').forEach(card => card.classList.remove('opacity-40', 'highlight'));
        }

        // Función para renderizar el gráfico (se mantiene igual, se ajusta a los nuevos datos)
        function renderChart() {
            const ctx = document.getElementById('proportionalityChart').getContext('2d');
            const sessionCounts = {};

            // Contar solo las sesiones 2 y 3 (Sesiones de Razonamiento)
            scheduleData.forEach(week => {
                if (week.session2.subject !== 'Sin asignar') {
                    sessionCounts[week.session2.subject] = (sessionCounts[week.session2.subject] || 0) + 1;
                }
                if (week.session3.subject !== 'Sin asignar') {
                    sessionCounts[week.session3.subject] = (sessionCounts[week.session3.subject] || 0) + 1;
                }
            });
            
            const sortedSubjects = Object.keys(sessionCounts).sort((a, b) => sessionCounts[b] - sessionCounts[a]);
            const labels = sortedSubjects;
            const data = sortedSubjects.map(subject => sessionCounts[subject]);
            const backgroundColors = sortedSubjects.map(subject => subjectColors[subject] || '#6B7280');

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Nº de Sesiones',
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: '#FDFBF8',
                        borderWidth: 3,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    family: 'Inter',
                                    size: 12
                                },
                                boxWidth: 15,
                                padding: 15
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += context.parsed + ' sesiones';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const subjectFiltersContainer = document.getElementById('subject-filters');
            const ambitoFiltersContainer = document.getElementById('ambito-filters');
            const resetBtn = document.getElementById('reset-filters');
    
            // Se filtran las materias para los botones (Matemáticas no se filtra porque es fija en Sesión 1)
            const subjects = [...new Set(scheduleData.flatMap(w => [w.session2.subject, w.session3.subject]))].filter(s => s !== 'Sin asignar').sort();
            const ambitos = [...new Set(scheduleData.flatMap(w => [w.session1.ambito, w.session2.ambito, w.session3.ambito]))].filter(a => a !== 'Desconocido').sort();
    
            function createFilterButtons(container, items, type) {
                items.forEach(item => {
                    const button = document.createElement('button');
                    button.textContent = item;
                    button.dataset.filter = item;
                    button.dataset.type = type;
                    button.className = 'filter-btn px-4 py-1.5 text-sm font-medium text-gray-700 bg-gray-100 rounded-full hover:bg-gray-200';
                    container.appendChild(button);
                });
            }
    
            createFilterButtons(subjectFiltersContainer, subjects, 'subject');
            createFilterButtons(ambitoFiltersContainer, ambitos, 'ambito');
            
            // RENDERIZADO AJUSTADO A LAS NUEVAS SEMANAS
            // Primera Evaluación (14 semanas: 1-14)
            renderSchedule(scheduleData.slice(0, 14), 'evaluation-content-1', 0); 
            // Segunda Evaluación (11 semanas: 15-25)
            renderSchedule(scheduleData.slice(14, 25), 'evaluation-content-2', 14); 
            // Tercera Evaluación (11 semanas: 26-36)
            renderSchedule(scheduleData.slice(25, 36), 'evaluation-content-3', 25); 
    
            renderChart();
            
            document.getElementById('controls').addEventListener('click', (e) => {
                if (e.target.classList.contains('filter-btn')) {
                    const { filter, type } = e.target.dataset;
                    applyFilter(filter, type);
                }
            });
    
            resetBtn.addEventListener('click', resetFilters);
        });
    </script>
</body>
</html>